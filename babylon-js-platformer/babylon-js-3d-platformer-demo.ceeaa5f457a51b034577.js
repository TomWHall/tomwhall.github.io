/*! For license information please see babylon-js-3d-platformer-demo.ceeaa5f457a51b034577.js.LICENSE.txt */
(()=>{"use strict";var t,e={9275:(t,e,n)=>{var i=n(7294),o=n(745),r=n(6081),a=n(2352),s=n(3182),c=n(2922),h=n(5412),l=n(6639),d=n(878);const m={log(...t){console&&console.log(...t)}};var u,p,g,w=n(4179);!function(t){t[t.Left=1]="Left",t[t.Right=2]="Right"}(u||(u={})),function(t){t[t.Forward=1]="Forward",t[t.Backward=2]="Backward"}(p||(p={})),function(t){t[t.Background=0]="Background",t[t.Solid=1]="Solid"}(g||(g={}));var f=n(1756);let y=0;function M(){return y++,y.toString()}function b(t){const e=t.getHierarchyBoundingVectors();return e.max.y-e.min.y}function P(t,e=!0){t.metadata=t.metadata??{},t.metadata.castsShadows=e}function v(t){const e=new w.Y(M());let n=0;return t.forEach((t=>{t.parent=e;const i=t.getHierarchyBoundingVectors(),o=i.max.y-i.min.y;t.position.y=n+-i.min.y,n+=o})),e}function T(t,...e){let n=f.y.FromMesh(t);e.forEach((t=>{const e=f.y.FromMesh(t);n=n.subtract(e)}));const i=n.toMesh(M());return i.material=t.material,i.metadata=t.metadata,t.dispose(),e.forEach((t=>{t.dispose()})),i}var k;!function(t){t[t.Pavement=0]="Pavement",t[t.Metal=1]="Metal",t[t.Glass=2]="Glass",t[t.LeatherBrown=3]="LeatherBrown",t[t.FabricGrey=4]="FabricGrey",t[t.Skin=5]="Skin",t[t.BricksOrange=6]="BricksOrange",t[t.WoodRed=7]="WoodRed",t[t.BooleanSign=8]="BooleanSign"}(k||(k={}));const B=new Array(9);function S(t,e,n){m.log(`Error loading texture from URL ${t.url}`,e,n)}function I(t,e,n){const i=t.clone();return i.uScale=e,i.vScale=n,i}B[k.Pavement]=["Pavement/pavement.jpg",null,"Pavement/pavement-spec.jpg"],B[k.Metal]=["Metal/metal.jpg","Metal/metal-normal.jpg","Metal/metal-spec.jpg"],B[k.Glass]=["Glass/glass.jpg"],B[k.LeatherBrown]=["LeatherBrown/leather-brown.jpg","LeatherBrown/leather-brown-normal.jpg","LeatherBrown/leather-brown-spec.jpg"],B[k.FabricGrey]=["FabricGrey/fabric-grey.jpg","FabricGrey/fabric-grey-normal.jpg","FabricGrey/fabric-grey-spec.jpg"],B[k.Skin]=["Skin/skin.jpg"],B[k.BricksOrange]=["BricksOrange/bricks-orange.jpg","BricksOrange/bricks-orange-normal.jpg","BricksOrange/bricks-orange-spec.jpg"],B[k.WoodRed]=["WoodRed/wood-red.jpg","WoodRed/wood-red-normal.jpg","WoodRed/wood-red-spec.jpg"],B[k.BooleanSign]=["BooleanSign/boolean-sign.jpg"];const x=async function(t){const e=new l.Sp(t);return B.forEach(((t,n)=>{const i=`img/${t[0]}`,o=e.addTextureTask(`TextureTask-${i}`,i);if(o.onSuccess=function(t){L[n]=L[n]??{},L[n].Color=o.texture},o.onError=S,t.length>=2&&t[1]){const i=`img/${t[1]}`,r=e.addTextureTask(`TextureTask-${i}`,i);r.onSuccess=function(t){L[n]=L[n]??{},L[n].Normal=o.texture},r.onError=S}if(t.length>=3&&t[2]){const i=`img/${t[2]}`,r=e.addTextureTask(`TextureTask-${i}`,i);r.onSuccess=function(t){L[n]=L[n]??{},L[n].Spec=o.texture},r.onError=S}})),new Promise(((t,n)=>{m.log("Loading assets");const i=performance.now();e.onFinish=e=>{const n=performance.now()-i;m.log(`Loaded assets in ${n}ms`),t()},e.load()}))},O=function(t,e,n){const i=L[t],o=I(i.Color,e,n),r=new d.K(M());return r.diffuseTexture=o,r.ambientTexture=o,i.Normal&&(r.bumpTexture=I(i.Normal,e,n)),i.Spec&&(r.specularTexture=I(i.Spec,e,n)),r},D=function(){const t=new d.K(M());return t.alpha=0,t},L={};n(3374);var R=n(2587),A=n(9982),j=n(5504),F=n(5592),V=n(8174),E=n(9060),C=n(6623),G=n(7870),U=n(2186),N=n(7309),W=n(2300);function z(t,e,n,i,o){const r=(0,F.NR)(M(),{width:t,height:e,depth:n,wrap:!0});return r.metadata={type:g.Solid,castsShadows:!0},i&&(r.position=i),o&&(r.material=o),r}function H(t,e,n=!1){const i=t.getVerticesData(U.o.PositionKind),o=i.length/3;for(let t=0;t<o;t++){const n=3*t;i[n+1]>0&&(i[n]*=e,i[n+2]*=e)}t.setVerticesData(U.o.PositionKind,i),n?t.bakeTransformIntoVertices(h.y3.RotationZ(Math.PI)):t.bakeCurrentTransformIntoVertices()}function K(t,e,n,i,o=!1){const r=(0,F.NR)(M(),{width:t,height:e,depth:n,updatable:!0});return H(r,i,o),r}const Y=c.Wo.FromHexString("#ffff99"),_=c.Wo.FromHexString("#ffcc33");function $(t,e){return O(k.Metal,2*t,2*e)}function Q(t,e){const n=(0,V.wf)(M(),{diameter:t,height:e});return n.material=$(1,e/t/3),P(n),n}function Z(t,e){const n=(0,V.wf)(M(),{diameter:t,height:e});return n.material=$(1,1),P(n),n}function q(t,e,n){const i=(0,V.wf)(M(),{diameterBottom:t,diameterTop:e,height:n});return i.material=$(1,n/t/2),P(i),i}function X(t,e,n){const i=(0,W.iz)(M(),{radiusBottom:t/2,radiusTop:e/2,height:n});return i.material=$(1,n/t/2),P(i),i}function J(t,e,n){const i=(0,F.NR)(M(),{width:t,height:e,depth:n,wrap:!0,updatable:!0});return i.material=$(1,e/t),P(i),i}function tt(t,e,n,i,o=!1){const r=K(t,e,n,i,o);return r.material=$(1,e/t),P(r),r}function et(){const t=.375;return v([Z(2,.1),Q(.9,1),Q(1,.1),q(.8,.4,2),Q(.5,.1),Q(.25,.6325*10),tt(t,t,t,.7,!0)])}function nt(){const t=Q(.25,1),e=Q(.25,1);e.bakeTransformIntoVertices(h.y3.RotationX(Math.PI/2)),e.bakeTransformIntoVertices(h.y3.Translation(0,0,.5));const n=Q(.75,.05);n.bakeTransformIntoVertices(h.y3.RotationX(Math.PI/2)),n.bakeTransformIntoVertices(h.y3.Translation(0,0,.975));const i=function(t){const e=(0,C.Qk)(M(),{diameter:.375});return e.material=$(1,1),P(e),e}();return i.position.y=-.5,G.Kj.MergeMeshes([t,e,n,i])}function it(t){const e=new w.Y(M()),n=function(t){const e=K(1,1,1,.5,!0),n=O(k.Glass,2,2);return n.diffuseColor=_,n.ambientColor=_,n.emissiveColor=_,n.specularPower=4,n.alpha=.75,e.material=n,P(e),new j.c(M(),t).customEmissiveColorSelector=function(t,n,i,o){t===e?o.set(.5,.40625,.125,.9):o.set(0,0,0,0)},e}(t);n.parent=e,(function(){const t=.05,e=.5,n=J(t,1,t);n.position.x=-.5,n.position.z=-.5;const i=J(t,1,t);i.position.x=e,i.position.z=-.5;const o=J(t,1,t);o.position.x=-.5,o.position.z=e;const r=J(t,1,t);r.position.x=e,r.position.z=e;const a=G.Kj.MergeMeshes([n,i,o,r]);return a.markVerticesDataAsUpdatable(U.o.PositionKind,!0),H(a,.5,!0),a.material=$(1,1),a}()).parent=e;const i=n.getBoundingInfo().boundingBox.maximumWorld.y,o=new h.P(0,i-.1875,0),r=new E.P(M(),o,new h.P(0,-1,0),.5*Math.PI,16,t);r.intensity=8,r.parent=e,r.metadata={};const a=new N.u(1024,r);a.usePoissonSampling=!0,r.metadata.shadowGenerator=a;const s=(0,C.Qk)(M(),{diameter:.375});s.position=o,s.parent=e;const c=O(k.Glass,2,2);return c.diffuseColor=Y,c.ambientColor=Y,c.emissiveColor=Y,c.specularPower=4,s.material=c,e}function ot(t){return v([J(.5,.05,.5),it(t),J(1.25,.05,1.25),tt(1,.5,1,.5),X(.3,.15,.5)])}function rt(t,e,n,i,o,r,a){const s=o-i,c=Math.sqrt(s*s+s*s)+2,l=(0,F.NR)(M(),{width:.25,height:1,depth:c,wrap:!0}),d=c/1*2;l.material=O(k.Metal,d,2),l.metadata={type:g.Solid};const m=o-i,u=(r/2-.125)*(a?-1:1);l.position=new h.P(u,m/2,m/2+.5),l.rotation=new h.P(-Math.PI/4,0,0);const p=(0,F.NR)(M(),{width:1e3,height:4,depth:1e3});p.position.y=o+2;const w=(0,F.NR)(M(),{width:1e3,height:4,depth:1e3});w.position.y=i-2,T(l,p,w).parent=t}var at=n(6806);class st{scene;directionalLight;hemisphericLight;constructor(t){this.scene=t,this.buildGround(),this.buildWall(),this.buildDoor(t),this.buildSign(),function(t,e,n,i,o){const r=new w.Y(M());r.position=new h.P(t,n,e-1),function(t,e,n,i,o,r){const a=o-i,s=Math.sqrt(a*a+a*a),c=(0,F.NR)(M(),{width:r,height:.01,depth:s,wrap:!0});c.material=D(),c.metadata={type:g.Solid};const l=o-i;c.position=new h.P(0,l/2,l/2),c.rotation=new h.P(-Math.PI/4,0,0),c.parent=t;const d=(0,F.NR)(M(),{width:r,height:.1,depth:1});d.position=new h.P(0,l-.05,l+.5),d.metadata={type:g.Solid},d.material=D(),d.parent=t}(r,0,0,n,i,o),rt(r,0,0,n,i,o,!0),rt(r,0,0,n,i,o,!1),function(t,e,n,i,o,r){const a=o-i,s=Math.floor(a/1);for(let e=1;e<=s;e++){const n=(0,F.NR)(M(),{width:r-.25,height:.1,depth:1,wrap:!0});n.parent=t,n.position=new h.P(0,1*e-.05-.001,1*e+.5),n.metadata={type:g.Background,castsShadows:!0};const i=2,o=r/1*i;n.material=O(k.Metal,o,i)}}(r,0,0,n,i,o)}(-10,7,0,8,4),this.buildPromenade(),function(t,e){const n=v([et(),ot(t)]),i=b(n),o=(0,V.wf)(M(),{diameter:1,height:i});o.parent=n,o.position.y=i/2,o.material=D(),o.metadata={type:g.Solid},e&&(n.position=e)}(t,new h.P(5,0,-5)),function(t,e){const n=v([nt(),ot(t)]),i=b(n),o=(0,F.NR)(M(),{width:1,height:i});o.parent=n,o.position.y=i/2,o.material=D(),o.metadata={type:g.Solid},e&&(n.position=e)}(t,new h.P(-7,12,14)),(this.hemisphericLight=new R.e(M(),new h.P(0,20,0),t)).intensity=.2,this.directionalLight=function(t){const e=new at.O(M(),new h.P(-1,-1,1),t);e.position=new h.P(30,30,-30),e.intensity=.3;const n=c.Wo.FromHexString("#E5F1FF");e.diffuse=n,e.specular=n;const i=new N.u(1024,e);return i.usePoissonSampling=!0,e.metadata={shadowGenerator:i},e}(t)}buildGround(){z(32,1,32,new h.P(0,-.5,0),O(k.Pavement,6,6))}buildWall(){T(z(32,16,1,new h.P(0,8,15.5),O(k.BricksOrange,8,4)),z(3,6,6,new h.P(-10,11,15.5)))}buildDoor(t){z(2.9,5.9,.5,new h.P(-10,11,15.5),O(k.WoodRed,1,1));const e=(0,C.Qk)(M(),{diameter:.3});e.position=new h.P(-11.1,11.2,15),e.material=O(k.Metal,1,1),P(e);const n=(0,V.wf)(M(),{diameter:.2,height:.3});n.rotation=new h.P(Math.PI/2,0,0),n.position=new h.P(-11.1,11.2,15.1),n.material=O(k.Metal,1,1),P(n),z(.3,.8,.01,new h.P(-11.1,11,15.24),O(k.Metal,1,1));const i=T(z(3,6,.7,new h.P(-10,11,15.5)),z(2.9,5.9,1,new h.P(-10,11,15.5)));i.metadata=null,new j.c(M(),t).customEmissiveColorSelector=function(t,e,n,o){t===i?o.set(1,.8125,.25,1):o.set(0,0,0,0)}}buildSign(){z(7,7,.01,new h.P(-3,8,15),O(k.BooleanSign,1,1));const t=O(k.Metal,1,1);function e(e){const n=(0,V.wf)(M(),{diameter:.2,height:.3});n.rotation=new h.P(Math.PI/2,0,0),n.position=e,n.material=t,P(n)}e(new h.P(-6.3,4.7,15)),e(new h.P(.3,4.7,15)),e(new h.P(-6.3,11.3,15)),e(new h.P(.3,11.3,15))}buildPromenade(){const t=new w.Y(M());z(32,2,8,new h.P(0,1,0),O(k.Pavement,6,1.5)).parent=t,z(32,2,.2,new h.P(0,1,-4.1),O(k.BricksOrange,8,.5)).parent=t,z(32,2,1,new h.P(0,3,3.5),O(k.BricksOrange,8,.5)).parent=t;const e=function(t,e,n,i){const o=(0,V.wf)(M(),{diameter:1,height:32});return o.metadata={type:g.Solid,castsShadows:!0},n&&(o.position=n),i&&(o.material=i),o}(0,0,new h.P(0,4,3.5),O(k.BricksOrange,.5,8));e.rotation=new h.P(0,0,Math.PI/2),e.parent=t,t.position=new h.P(12,0,0),t.rotation=new h.P(0,Math.PI/2,0)}preStart(){this.scene.lights.forEach((t=>{if(t instanceof A.O){const e=t.metadata.shadowGenerator;this.scene.meshes.forEach((t=>{t.metadata?.castsShadows&&(e.addShadowCaster(t),t.receiveShadows=!0)}))}}))}}class ct{loadingUIText;loadingUIBackgroundColor;displayLoadingUI(){}hideLoadingUI(){}}n(1774);var ht=n(5241),lt=n(3830),dt=n(6181),mt=n(1622),ut=n(9549),pt=n(3810);function gt(t,e,n,i,o){const r=n?"left-arm":"right-arm",a=new w.Y(r),s=(0,W.iz)(r+"-shoulder",{radius:e/2,height:2*e,orientation:h.P.Right()});s.bakeTransformIntoVertices(h.y3.Translation(e/2,0,0)),s.parent=a;const c=(0,V.wf)(r+"-cylinder",{diameter:e,height:t-e});c.bakeTransformIntoVertices(h.y3.Translation(0,-(t-e)/2,0));const l=G.Kj.MergeMeshes([c,s]);l.material=i,P(l),l.parent=a;const d=(0,C.Qk)(r+"-hand",{diameter:e});return d.bakeTransformIntoVertices(h.y3.Translation(0,-(t-e),0)),d.material=o,P(d),d.parent=a,n||(a.scaling=new h.P(-1,1,1)),a}function wt(t,e,n,i,o,r){const a=new w.Y(r),s=e,c=function(t,e,n){const i=new w.Y(M()),o=2*t,r=t/2,a=(0,W.iz)(M(),{radius:t/2,height:o,orientation:h.P.Forward()}),s=(0,F.NR)(M(),{width:t,height:r,depth:o});s.bakeTransformIntoVertices(h.y3.Translation(0,-r/2,0));const c=f.y.FromMesh(a).subtract(f.y.FromMesh(s)).toMesh(M());a.dispose(),s.dispose(),c.parent=i;const l=o/2-t/2,d=(0,V.wf)(M(),{diameter:t,height:r});d.bakeTransformIntoVertices(h.y3.Translation(0,r/2,-l));const m=G.Kj.MergeMeshes([c,d]);m.material=e,P(m),m.parent=i;const u=1.05*t,p=r/4,g=(0,V.wf)(M(),{diameter:u,height:p});g.bakeTransformIntoVertices(h.y3.Translation(0,0,l));const y=(0,V.wf)(M(),{diameter:u,height:p});y.bakeTransformIntoVertices(h.y3.Translation(0,0,-l));const b=(0,F.NR)(M(),{width:u,height:p,depth:o-t}),v=G.Kj.MergeMeshes([g,b,y]);return v.bakeTransformIntoVertices(h.y3.Translation(0,-p/2,0)),v.material=n,P(v),v.parent=i,function(t){const e=t.getHierarchyBoundingVectors(),n=-(e.min.x+(e.max.x-e.min.x)/2),i=-(e.min.y+(e.max.y-e.min.y)/2),o=-(e.min.z+(e.max.z-e.min.z)/2);t.locallyTranslate(new h.P(n,i,o))}(i),i}(s,i,o),l=function(t){const e=t.getHierarchyBoundingVectors();return e.max.z-e.min.z}(c),d=b(c),m=t-d,u=(0,V.wf)(M(),{diameter:e,height:m});return u.bakeTransformIntoVertices(h.y3.Translation(0,-m/2,0)),u.material=n,u.parent=a,P(u),c.parent=a,c.translate(h.P.Down(),m+d/2,ht.T.LOCAL),c.translate(h.P.Forward(),l/2-1.1*s/2,ht.T.LOCAL),a}function ft(t,e){const n=(0,C.Qk)(M(),{diameter:t});return n.scaling=new h.P(.4,1,.6),n.material=e,n}function yt(t,e){const n=new ut.f(t,"rotation.x",60,ut.f.ANIMATIONTYPE_FLOAT,ut.f.ANIMATIONLOOPMODE_CYCLE),i=[];return i.push({frame:0,value:0}),i.push({frame:15,value:e}),i.push({frame:45,value:-e}),i.push({frame:60,value:0}),n.setKeys(i),n}const Mt={movementSpeedDelta:.005,maxMovementSpeed:.3,verticalSpeedDelta:.01,minVerticalSpeed:-1,jumpInitialVerticalSpeed:.28,obstructingMeshOpacity:.4},bt=.75,Pt=h.P.Forward(),vt=h.P.Up(),Tt=Math.PI/8,kt=Math.PI/8;function Bt(t){const e=t.getHierarchyBoundingVectors();return e.max.y-e.min.y}class St{game;container;collider=null;rayDetector=null;camera;ray;rotationDirection=null;movementDirection=null;forwardIncrement=0;upIncrement=0;isOnMesh;coat;leftArm;rightArm;leftLeg;rightLeg;leftFoot;walkAnimationGroup;obstructingMeshTop=null;obstructingMeshBottom=null;lastOnSolidTime=0;constructor(t,e){this.game=t,this.buildGeometry(),this.addAnimations();const n=this.camera=new lt.x(M(),new h.P(0,10,-15),this.game.scene);n.parent=this.container,n.target=new h.P(0,0,25),this.ray=new dt.z(h.P.Zero(),h.P.Zero(),1e3),this.setPosition(e)}setPosition(t){this.container.position=t}update(t,e){const{forwardIncrement:n,upIncrement:i}=this,{movementSpeedDelta:o,maxMovementSpeed:r,verticalSpeedDelta:a,minVerticalSpeed:s}=Mt,c=this.game.scene.meshes.filter((t=>t.metadata?.type===g.Solid));let h,l=this.isOnMesh=!1,d=0,m=n,w=!1,f=!1;if(h=i-a*this.game.tickTimeFactor,h=Math.max(h,s),h<=0){const e=this.tryMove(0,h,c).collidingMesh;if(e){const t=e.getBoundingInfo().boundingBox.maximumWorld.y;if(t<this.container.position.y){const e=t-this.container.position.y;this.tryMove(0,e,c)}}l=this.isOnMesh=void 0!==e,l&&(h=0,this.lastOnSolidTime=t)}if(l){const t=this.rotationDirection;t&&(d=Math.PI/64*e*(t===u.Left?-1:1));const n=this.movementDirection;n?n===p.Forward?(m+=o*this.game.tickTimeFactor,m=Math.min(m,r)):(m-=o*this.game.tickTimeFactor,m=Math.max(m,-r)):(m*=.8,m<.01&&(m=0))}if(0!==d){const t=this.tryRotate(d,c).collidingMesh;void 0===t?f=!0:t.rotation.x===-Math.PI/4?void 0===this.tryMove(0,.025,c).collidingMesh&&void 0===this.tryRotate(d,c).collidingMesh&&(f=!0):void 0===this.tryMove(-.1,0,c).collidingMesh&&void 0===this.tryRotate(d,c).collidingMesh&&(f=!0)}0===m&&0===h||(void 0===this.tryMove(m,h,c).collidingMesh?w=!0:0!==m&&(void 0===this.tryMove(m,Math.abs(m),c).collidingMesh?(w=!0,m=Math.min(m,.25*r)):(this.tryStepUp(m,c)||void 0===this.tryMove(0,h,c).collidingMesh)&&(w=!0)),w||(m=0,h=0)),this.forwardIncrement=m,this.upIncrement=h,l||t-this.lastOnSolidTime<250?this.walkAnimationGroup.speedRatio=w?15*this.forwardIncrement:f?1:0:this.walkAnimationGroup.speedRatio=0,this.handleObscuringMeshes()}tryStepUp(t,e){for(let n=.1;n<=1;n+=.1)if(void 0===this.tryMove(t,n,e).collidingMesh)return!0;return!1}tryMove(t,e,n){const i=this.container;i.translate(Pt,t,ht.T.LOCAL),i.translate(vt,e,ht.T.LOCAL),this.updateMatrices();const o=this.getCollidingMesh(n);return void 0!==o&&(i.translate(Pt,-t,ht.T.LOCAL),i.translate(vt,-e,ht.T.LOCAL),this.updateMatrices()),{collidingMesh:o}}tryRotate(t,e){const n=this.container;n.addRotation(0,t,0),this.updateMatrices();const i=this.getCollidingMesh(e);return void 0!==this.getCollidingMesh(e)&&(n.addRotation(0,-t,0),this.updateMatrices()),{collidingMesh:i}}handleObscuringMeshes(){this.obstructingMeshTop&&(this.obstructingMeshTop.visibility=1,this.obstructingMeshTop=null),this.obstructingMeshBottom&&(this.obstructingMeshBottom.visibility=1,this.obstructingMeshBottom=null);const t=this.getHitMesh(3);t&&t!==this.rayDetector&&(this.obstructingMeshTop=t,this.obstructingMeshTop.visibility=Mt.obstructingMeshOpacity);const e=this.getHitMesh(1);e&&e!==this.rayDetector&&(this.obstructingMeshBottom=e,this.obstructingMeshBottom.visibility=Mt.obstructingMeshOpacity)}getHitMesh(t){const e=this.getWorldPosition(this.camera),n=this.getWorldPosition(this.container).add(new h.P(0,t,0)),i=this.ray;return i.origin=e,i.direction=n.subtract(e),this.game.scene.pickWithRay(i,(t=>t===this.rayDetector||t.metadata?.type===g.Solid),!1).pickedMesh}getWorldPosition(t){const e=t.getWorldMatrix(),n=new h._f,i=new h.P,o=new h.P;return e.decompose(o,n,i),i}jump(){this.isOnMesh&&(this.upIncrement=Mt.jumpInitialVerticalSpeed)}getCollidingMesh(t){return t.find((t=>function(t){return t.metadata?.type===g.Solid}(t)&&this.collider.intersectsMesh(t,!0)&&t.getBoundingInfo().boundingBox.maximumWorld.y!==this.container.position.y))}updateMatrices(){this.collider.computeWorldMatrix(!0)}buildGeometry(){const t=this.container=new w.Y(M()),e=O(k.Skin,2,2),n=O(k.Metal,4,4),i=O(k.FabricGrey,1,1),o=O(k.LeatherBrown,1,1),r=function(t,e,n,i,o,r,a){const s=new w.Y(M()),c=function(t,e,n,i){const o=(0,V.wf)(M(),{diameter:n,height:t});o.bakeTransformIntoVertices(h.y3.RotationZ(Math.PI/2));const r=e/2,a=(0,F.NR)(M(),{width:t,height:r,depth:n});a.bakeTransformIntoVertices(h.y3.Translation(0,r/2,0));const s=f.y.FromMesh(o).union(f.y.FromMesh(a)).toMesh(M());return o.dispose(),a.dispose(),P(s),s.material=i,s}(t,e,e,D()),l=b(c);c.parent=s,c.position.y=-l/2;const d=t/2-i/2,m=wt(n,i,o,r,a,"left-leg");m.parent=s,m.position.x=-d,m.position.y=-l/2;const u=wt(n,i,o,r,a,"right-leg");return u.parent=s,u.position.x=d,u.position.y=-l/2,s}(1,bt,2.4,.45,i,o,n);r.parent=t,r.position.y=Bt(r),this.leftLeg=r.getChildren((t=>"left-leg"==t.name))[0],this.rightLeg=r.getChildren((t=>"right-leg"==t.name))[0];const a=r.getDescendants(!1,(t=>-1!==t.name.indexOf("foot")));a.length>0&&(this.leftFoot=a[0]);const s=function(t,e,n,i){const o=(0,F.NR)(M(),{width:1,height:1.6,depth:n,wrap:!0}),r=(0,V.wf)(M(),{diameter:n,height:1});r.bakeTransformIntoVertices(h.y3.RotationZ(Math.PI/2)),r.bakeTransformIntoVertices(h.y3.Translation(0,.6125,0)),o.bakeTransformIntoVertices(h.y3.Translation(0,-.1875,0));const a=f.y.FromMesh(r).union(f.y.FromMesh(o)).toMesh(M());return r.dispose(),o.dispose(),a.material=i,P(a),a}(0,0,bt,i);s.parent=t;const c=Bt(r)-bt;s.position.y=c+.9875;const l=c+1.975;this.coat=s;const d=l-.165,m=this.leftArm=gt(1.92,.33,!0,i,e);m.parent=t,m.position.x=-.61,m.position.y=d;const u=this.rightArm=gt(1.92,.33,!1,i,e);u.parent=t,u.position.x=.61,u.position.y=d;const p=function(t,e){const n=new w.Y(M()),i=(0,W.iz)(M(),{radius:.35,height:1.75,orientation:h.P.Up()});i.bakeTransformIntoVertices(h.y3.Scaling(1,.5,1)),i.material=e,P(i),i.parent=n;const o=ft(.35,e);o.position=new h.P(-.35,0,0),o.parent=n;const r=ft(.35,e);r.position=new h.P(.35,0,0),r.parent=n;const a=(0,C.Qk)(M(),{diameter:.735}),s=(0,F.NR)(M(),{width:1.4,height:1.4,depth:1.4});s.position=new h.P(0,-.7,0);const c=T(a,s);return c.scaling=new h.P(1,1,1.2),c.bakeTransformIntoVertices(h.y3.RotationX(-Math.PI/3)),c.material=O(k.LeatherBrown,4,4),c.parent=n,n}(0,e);p.parent=t,p.position.y=l+Bt(p)/2;const g=function(t,e,n){const i=.005,o=.125,r=.4325,a=(0,V.wf)(M(),{diameterBottom:.77,diameterTop:.63,height:r});a.position.y=.22125;const s=1.6*t,c=(0,V.wf)(M(),{diameter:s,height:i});c.position.y=.0025;const h=(0,pt.eu)(M(),{diameter:.505,thickness:o});h.position.y=.4375;const l=.10499999999999998,d=(0,pt.eu)(M(),{diameter:1.015,thickness:l});d.position.y=.05249999999999999;const m=G.Kj.MergeMeshes([a,h,c,d],!0);return m.material=n,P(m),m}(.7,0,i);g.parent=t,g.position.y=l+Bt(p)-.3;const y=Bt(t),v=this.collider=z(1,y,bt);v.parent=t,v.position.y=y/2,v.material=D(),v.metadata=null;const B=this.rayDetector=z(1,y,bt);B.parent=t,B.position.y=y/2,B.material=D(),B.metadata=null}addAnimations(){const t=yt("leftArmRotate",Tt);this.leftArm.animations.push(t);const e=yt("rightArmRotate",-Tt);this.rightArm.animations.push(e);const n=yt("leftLegRotate",-kt);this.leftLeg.animations.push(n);const i=yt("rightLegRotate",kt);this.rightLeg.animations.push(i);const o=this.walkAnimationGroup=new mt.O("walk");o.addTargetedAnimation(t,this.leftArm),o.addTargetedAnimation(e,this.rightArm),o.addTargetedAnimation(n,this.leftLeg),o.addTargetedAnimation(i,this.rightLeg),o.start(!0,1)}}class It{canvas;scene;player;terrain;lastAnimateTime=performance.now();active=!0;tickTimeFactor=1;async initialize(t){m.log("Game initializing"),this.canvas=t,t.style.width=window.innerWidth+"px",t.style.height=window.innerHeight+"px";const e=new a.D(t,!0,{adaptToDeviceRatio:!0});e.loadingScreen=new ct,e.displayLoadingUI();const n=this.scene=new s.x(e);n.clearColor=new c.HE(0,0,0,1),await x(n),this.addInputHandlers()}upButtonDown(){this.player.movementDirection=p.Forward}upButtonUp(){this.player.movementDirection=null}downButtonDown(){this.player.movementDirection=p.Backward}downButtonUp(){this.player.movementDirection=null}leftButtonDown(){this.player.rotationDirection=u.Left}leftButtonUp(){this.player.rotationDirection=null}rightButtonDown(){this.player.rotationDirection=u.Right}rightButtonUp(){this.player.rotationDirection=null}jumpButtonDown(){this.player.jump()}start(){m.log("Game starting"),this.terrain=new st(this.scene),this.player=new St(this,new h.P(-3,0,-3)),this.terrain.preStart(),this.canvas.focus(),this.lastAnimateTime=performance.now(),this.animate(performance.now())}addInputHandlers(){this.scene.onKeyboardObservable.add((t=>{switch(t.type){case r.OG.KEYDOWN:switch(t.event.key){case"ArrowLeft":this.leftButtonDown();break;case"ArrowRight":this.rightButtonDown();break;case"ArrowUp":this.upButtonDown();break;case"ArrowDown":this.downButtonDown();break;case" ":this.jumpButtonDown()}break;case r.OG.KEYUP:switch(t.event.key){case"ArrowLeft":this.leftButtonUp();break;case"ArrowRight":this.rightButtonUp();break;case"ArrowUp":this.upButtonUp();break;case"ArrowDown":this.downButtonUp()}}}))}animate(t){if(requestAnimationFrame(this.animate.bind(this)),this.active){let e=t-(this.lastAnimateTime||t);e>500&&(e=0),this.lastAnimateTime=t;const n=e/(1e3/60);this.player.update(t,n)}this.scene.render()}}function xt(t,e,n){return i.createElement("div",{className:t,onTouchStart:e,onMouseDown:e,onTouchEnd:n,onMouseUp:n})}const Ot=document.getElementById("app");(0,o.s)(Ot).render(i.createElement((()=>{const[t,e]=(0,i.useState)(new It),[n,o]=(0,i.useState)(i.createRef());let[r,a]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{t.initialize(n.current).then((()=>{a(!0),t.start()}))}),[]),i.createElement(i.Fragment,null,i.createElement("canvas",{id:"viewport",ref:n}),!r&&i.createElement("div",{id:"loading"},i.createElement("div",null,"Loading, please wait...")),r&&i.createElement(i.Fragment,null,i.createElement("div",{className:"arrows"},xt("up-arrow",(()=>t.upButtonDown()),(()=>t.upButtonUp())),xt("left-arrow",(()=>t.leftButtonDown()),(()=>t.leftButtonUp())),xt("down-arrow",(()=>t.downButtonDown()),(()=>t.downButtonUp())),xt("right-arrow",(()=>t.rightButtonDown()),(()=>t.rightButtonUp()))),xt("space-bar",(()=>t.jumpButtonDown()),(()=>{}))))})))}},n={};function i(t){var o=n[t];if(void 0!==o)return o.exports;var r=n[t]={exports:{}};return e[t](r,r.exports,i),r.exports}i.m=e,t=[],i.O=(e,n,o,r)=>{if(!n){var a=1/0;for(l=0;l<t.length;l++){for(var[n,o,r]=t[l],s=!0,c=0;c<n.length;c++)(!1&r||a>=r)&&Object.keys(i.O).every((t=>i.O[t](n[c])))?n.splice(c--,1):(s=!1,r<a&&(a=r));if(s){t.splice(l--,1);var h=o();void 0!==h&&(e=h)}}return e}r=r||0;for(var l=t.length;l>0&&t[l-1][2]>r;l--)t[l]=t[l-1];t[l]=[n,o,r]},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={63:0};i.O.j=e=>0===t[e];var e=(e,n)=>{var o,r,[a,s,c]=n,h=0;if(a.some((e=>0!==t[e]))){for(o in s)i.o(s,o)&&(i.m[o]=s[o]);if(c)var l=c(i)}for(e&&e(n);h<a.length;h++)r=a[h],i.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return i.O(l)},n=self.webpackChunkbabylon_js_3d_platformer_demo=self.webpackChunkbabylon_js_3d_platformer_demo||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var o=i.O(void 0,[736],(()=>i(9275)));o=i.O(o)})();