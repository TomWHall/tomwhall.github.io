/*! For license information please see p2babylonunicycle.ca93d1a0945026aa1519.js.LICENSE.txt */
(()=>{"use strict";var t,e={8341:(t,e,n)=>{var o;!function(t){t[t.Player=1]="Player",t[t.Terrain=2]="Terrain"}(o||(o={}));const a=o,s=p2,i=new s.Material,r=new s.Material,l=new s.Material,c={Player:i,PlayerTyre:r,Terrain:l},h=new s.ContactMaterial(r,l,{restitution:.4,stiffness:Number.MAX_VALUE,friction:1.25}),d={log(...t){console&&console.log(...t)}};var u=n(3529),p=n(1281);let m=0;function w(){return m++,m.toString()}const f={LeatherBlack:"leather-black.jpg",LeatherRed:"leather-red.jpg",MetalChrome:"metal-chrome.jpg",CheckRedWhite:"check-red-white.jpg",VelvetGreen:"velvet-green.jpg",Wood:"wood.jpg",FabricRed:"fabric-red.jpg",Tyre:"tyre.jpg",Skin:"skin.jpg",TilesRed:"tiles-red.jpg"},y={loadImages:function(t){return e=this,n=void 0,a=function*(){const e=new u.Sp(t);return Object.keys(f).forEach((t=>{const n=`img/${f[t]}`;e.addTextureTask(`TextureTask-${t}`,n).onSuccess=function(e){g[t]=e.texture}})),new Promise(((t,n)=>{d.log("Loading assets");const o=performance.now();e.onFinish=e=>{const n=performance.now()-o;d.log(`Loaded assets in ${n}ms`),t()},e.onTaskError=t=>{n(t.errorObject)},e.load()}))},new((o=void 0)||(o=Promise))((function(t,s){function i(t){try{l(a.next(t))}catch(t){s(t)}}function r(t){try{l(a.throw(t))}catch(t){s(t)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(i,r)}l((a=a.apply(e,n||[])).next())}));var e,n,o,a},getMaterial:function(t,e,n,o,a){const s=new p.kX(w(),a),i=t.clone();return e>n?(i.uScale=e/n*o,i.vScale=n*o):n>e?(i.uScale=e*o,i.vScale=n/e*o):(i.uScale=o,i.vScale=o),s.diffuseTexture=i,s}},g={};var P=n(3968),T=n(642);function v(t,e){return e&&(t.meshOptions=e),t}const b=function(t,e,n,o){return v(T.kg.CreateBox(w(),{width:t,height:e,depth:n,wrap:!0}),o)},I=function(t,e,n){return v(P.VO.CreateCylinder(w(),{diameter:t,height:e}),n)},M=function(t,e){return v(P.VO.CreateSphere(w(),{diameter:t}),e)},k=function(t,e,n){return v(P.VO.CreateTorus(w(),{diameter:t,thickness:e,tessellation:32}),n)};var C=n(74);const B={collisionGroup:a.Terrain,collisionMask:a.Player|a.Terrain};function S(t,e=c.Terrain){return t.material=e,t.collisionGroup=B.collisionGroup,t.collisionMask=B.collisionMask,t.meshes=[],t}function L(t,e,n,o){const a=new s.Body({position:[t[0],t[1]],mass:n}),i=S(new s.Box({width:e,height:.2})),r=((t,e)=>y.getMaterial(g.Wood,t,1,.25,e))(e,o),l=t=>{const n=b(e,.03,1);n.material=r,n.bakeTransformIntoVertices(C.y3.Translation(0,.085*(t?1:-1),0)),i.meshes.push(n)};l(!0),l(!1);const c=b(e-.06,.14,.94);return c.material=r,i.meshes.push(c),a.addShape(i),a}function V(t,e){const n=new s.RevoluteConstraint(t,e,{localPivotA:[0,0],localPivotB:[0,0]});return n.collideConnected=!1,n}const R={getPlatform:L,getSeesaw:function(t,e,n,o){const a=L(t,e,n,o),s=I(.1,1.5,{shadows:!1});return s.bakeTransformIntoVertices(C.y3.RotationX(.5*Math.PI)),s.material=(t=>{const e=y.getMaterial(g.MetalChrome,1,1,1,t);return e.specularPower=256,e})(o),a.shapes[0].meshes.push(s),a},getAnchor:function(t){const e=new s.Body({position:[t[0],t[1]]}),n=new s.Circle({radius:.1});return n.sensor=!0,e.addShape(n),e},getSeesawConstraint:V,getMotorSeesawConstraint:function(t,e){const n=V(t,e);return n.enableMotor(),n.setMotorSpeed(-.5),n},getTarget:function(t,e){const n=new s.Body({position:[t[0],t[1]]}),o=S(new s.Box({width:4,height:.2})),a=b(4,.2,4);return a.material=((t,e,n)=>y.getMaterial(g.TilesRed,4,4,4,n))(0,0,e),o.meshes.push(a),n.addShape(o),n}};var O,E=n(7733);class x{constructor(t,e){this.scene=e,t.addBody(R.getPlatform([7,15],18,0,e));const n=[-3,13.5],o=R.getSeesaw(n,4,50,e),a=R.getAnchor(n),s=R.getSeesawConstraint(o,a);t.addBody(o),t.addBody(a),t.addConstraint(s),t.addBody(R.getPlatform([0,11.5],4,0,e));const i=[4.025,11.5],r=R.getSeesaw(i,4,50,e),l=R.getAnchor(i),c=R.getMotorSeesawConstraint(r,l);t.addBody(r),t.addBody(l),t.addConstraint(c),t.addBody(R.getPlatform([6.5,9],3,0,e)),t.addBody(R.getPlatform([9.25,8],1,0,e)),t.addBody(R.getPlatform([11,7],1,0,e)),t.addBody(R.getTarget([14.25,6],e)),new E.ez(w(),new C.P(0,3,-6),e).intensity=.3;const h=this.spotLight=new E.PM(w(),new C.P(-6,20,3),C.P.Zero(),Math.PI/8,2,e);h.diffuse=new C.Wo(1,1,.9),h.intensity=5}handlePreWorldStart(){const t=new E.uX(1024,this.spotLight);t.useBlurExponentialShadowMap=!0,t.depthScale=8192,t.useKernelBlur=!0,t.blurKernel=8,this.scene.meshes.forEach((e=>{const n=e.meshOptions;!1!==(null==n?void 0:n.shadows)&&(t.getShadowMap().renderList.push(e),e.receiveShadows=!0)}))}handlePostWorldStep(t,e){const n=e[0];this.spotLight.setDirectionToTarget(new C.P(n[0],n[1]+.7,0))}}!function(t){t[t.Left=1]="Left",t[t.Right=2]="Right"}(O||(O={}));const A=O,W=function(t,e,n,o,a,i){const r=new s.Box(t);if(o&&(r.collisionGroup=o.collisionGroup,r.collisionMask=o.collisionMask),a){const o=b(t.width,t.height,e,i);o.translate(new C.P(0,0,1),n),o.material=a,r.meshes=[o]}return r},G=function(t,e,n,o,a){const i=new s.Box(t);if(n&&(i.collisionGroup=n.collisionGroup,i.collisionMask=n.collisionMask),o){const n=I(t.width,t.height,a);n.translate(new C.P(0,0,1),e),n.material=o,i.meshes=[n]}return i},X=function(t,e,n,o,a){const i=new s.Circle(t);if(n&&(i.collisionGroup=n.collisionGroup,i.collisionMask=n.collisionMask),o){const n=M(2*t.radius,a);n.translate(new C.P(0,0,1),e),n.material=o,i.meshes=[n]}return i},j=function(t,e,n,o,a,i){const r=new s.Circle(t);if(o&&(r.collisionGroup=o.collisionGroup,r.collisionMask=o.collisionMask),a){const o=I(2*t.radius,e,i);o.bakeTransformIntoVertices(C.y3.RotationX(-Math.PI/2)),o.bakeTransformIntoVertices(C.y3.Translation(0,0,n)),o.material=a,r.meshes=[o]}return r},H=t=>t/2,z=t=>2*t,D=.36,F=.08,U=.7,N=.05,q=.2,K=.25,Z=.5,Y=.5,$=.15,_=.4,Q=.125,J=.25,tt=H(K),et=.5*tt,nt=tt,ot=1.2*tt,at=.01,st=.8*tt,it=tt,rt=.1,lt={collisionGroup:a.Player,collisionMask:a.Terrain};function ct(t,e=c.Player){return t.material=e,t.collisionGroup=lt.collisionGroup,t.collisionMask=lt.collisionMask,t.meshes=[],t}function ht(t,e,n,o){const a=new P.YO("TempNode",o);a.translate(e,n);const s=a.position;t.bakeTransformIntoVertices(C.y3.Translation(s.x,s.y,s.z))}const dt=t=>y.getMaterial(g.LeatherRed,1,1,.25,t),ut=t=>y.getMaterial(g.CheckRedWhite,1,1,.5,t),pt=t=>y.getMaterial(g.FabricRed,1,1,.375,t),mt=t=>y.getMaterial(g.Skin,1,1,1,t),wt=t=>{const e=y.getMaterial(g.MetalChrome,1,1,1,t);return e.specularPower=256,e},ft=function(t,e){const n=new s.Body({mass:.2,position:[t[0],t[1]]}),o=ct(new s.Circle({radius:D}),c.PlayerTyre),a=(t=>y.getMaterial(g.Tyre,8,1,2,t))(e),i=wt(e),r=[],l=k(z(D)-F,F);l.bakeTransformIntoVertices(C.y3.RotationX(H(Math.PI))),l.material=a,r.push(l);const h=k(z(.95*D)-F,.064);h.bakeTransformIntoVertices(C.y3.RotationX(H(Math.PI))),h.material=i,r.push(h);const d=I(z(.072),.04);d.bakeTransformIntoVertices(C.y3.RotationX(-H(Math.PI))),d.material=i,r.push(d);const u=I(z(.018),.24,{shadows:!1});u.bakeTransformIntoVertices(C.y3.RotationX(-H(Math.PI))),u.material=i,r.push(u);for(let t=1;t<=8;t++){const e=I(.02,z(.324),{shadows:!1}),n=(new C.P(0,0,1),Math.PI/8*(t-1));e.bakeTransformIntoVertices(C.y3.RotationZ(n)),e.material=i,r.push(e)}const p=.13,m=.01,w=b(p,.02,m,{shadows:!1});w.bakeTransformIntoVertices(C.y3.Translation(.005-H(p),0,-.1-H(m))),w.material=i,r.push(w);const f=b(p,.02,m,{shadows:!1});return f.bakeTransformIntoVertices(C.y3.Translation(H(p)-.005,0,.1+H(m))),f.material=i,r.push(f),o.meshes=r,n.addShape(o),n},yt=function(t,e){const n=new s.Body({mass:.2,position:[t[0],t[1]+.35],angle:0}),o=wt(e);o.diffuseColor=new C.Wo(.125,.125,1);const a=.02,i=.08,r=ct(new s.Box({width:z(a),height:U})),l=t=>{const e=i*(t?-1:1),n=I(z(a),.4);n.bakeTransformIntoVertices(C.y3.Translation(0,-H(U)+H(.4),e)),n.material=o,r.meshes.push(n);const s=I(.08,a,{shadows:!1});s.bakeTransformIntoVertices(C.y3.RotationX(-H(Math.PI))),s.bakeTransformIntoVertices(C.y3.Translation(0,-H(U),e)),s.material=o,r.meshes.push(s)};l(!0),l(!1),n.addShape(r);const c=.4-H(U),h=I(z(a),z(i));h.bakeTransformIntoVertices(C.y3.RotationX(-H(Math.PI))),h.bakeTransformIntoVertices(C.y3.Translation(0,c,0)),h.material=o,r.meshes.push(h);const d=t=>{const e=i*(t?-1:1),n=M(z(a));n.bakeTransformIntoVertices(C.y3.Translation(0,c,e)),n.material=o,r.meshes.push(n)};d(!0),d(!1);const u=.29999999999999993,p=I(z(a),u);p.bakeTransformIntoVertices(C.y3.Translation(0,H(U)-H(u),0)),p.material=o,r.meshes.push(p);const m=ct(new s.Box({width:.3,height:N})),w=M(.3,{shadows:!1});w.scaling=new C.P(1,.16666666666666669,.2/.3),w.material=(t=>y.getMaterial(g.LeatherBlack,2,2,.25,t))(e),m.meshes.push(w),n.addShape(m,[0,H(U)+H(N)],0);const f=ut(e),P=ct(new s.Circle({radius:H(q)})),T=I(q,.3);new C.P(1,0,0),T.bakeTransformIntoVertices(C.y3.RotationX(H(Math.PI))),T.material=f,P.meshes.push(T);const v=t=>{const e=M(q);e.bakeTransformIntoVertices(C.y3.Translation(0,0,(H(Y)-H(q))*(t?-1:1))),e.material=f,P.meshes.push(e)};return v(!0),v(!1),n.addShape(P,[0,H(U)+N+H(q)],0),n},gt=function(t,e,n){const o=new s.Body({mass:.07*rt,position:[t[0]-.2,t[1]+.2]}),a=(H(.2)+H($))*(n?-1:1),i=ut(e);return o.addShape(G({width:$,height:_},a,lt,i)),o.addShape(X({radius:H($)},a,lt,i),[0,-.2],0),o},Pt=function(t,e,n){const o=new s.Body({mass:.009,position:[t[0]-.2,t[1]-.2]}),a=(H(.2)+H($))*(n?-1:1),i=ut(e),r=dt(e),l=wt(e);return o.addShape(G({width:$,height:_},a,lt,i)),o.addShape(W({width:.3,height:.1},.1,a,lt,r),[-.075,-.205]),o.addShape(j({radius:.1},.1,a,lt,r),[-.225,-.155]),o.addShape(W({width:.1,height:.05},.1,a,lt,l,{shadows:!1}),[-.175,-.28]),o},Tt=function(t,e){const n=new s.Body({mass:.05,position:[t[0],t[1]+.9]}),o=pt(e),a=W({width:K,height:Z-H(K)},Y,0,lt,o);n.addShape(a,[0,-.0625]);const i=ct(new s.Circle({radius:H(K)})),r=I(K,Y);r.bakeTransformIntoVertices(C.y3.RotationX(H(Math.PI))),r.material=o;const l=I(Q,.625);l.bakeTransformIntoVertices(C.y3.RotationX(H(Math.PI))),l.bakeTransformIntoVertices(C.y3.Translation(0,H(K)-H(Q),0)),l.material=o;const c=t=>{const e=M(Q);return e.bakeTransformIntoVertices(C.y3.Translation(0,H(K)-H(Q),0)),e.bakeTransformIntoVertices(C.y3.Translation(0,0,(H(Y)+H(Q))*(t?-1:1))),e.material=o,e};return i.meshes=[r,l,c(!0),c(!1)],n.addShape(i,[0,H(Z)-H(K)]),n},vt=function(t,e,n){const o=new s.Body({mass:.025*rt,position:[t[0],t[1]+.5]}),a=(H(Y)+H(Q))*(n?-1:1),i=pt(e);return o.addShape(G({width:Q,height:J},a,lt,i)),o},bt=function(t,e,n){const o=new s.Body({mass:.025*rt,position:[t[0],t[1]+.5]}),a=(H(Y)+H(Q))*(n?-1:1),i=pt(e),r=mt(e);return o.addShape(X({radius:H(Q)},a,lt,i),[0,H(J)]),o.addShape(X({radius:H(.1125)},a,lt,r),[0,-H(.3)]),o.addShape(G({width:Q,height:J},a,lt,i)),o},It=function(t,e){const n=new s.Body({mass:.07*rt,position:[t[0],t[1]]}),o=mt(e),a=dt(e),i=new p.kX(w(),e);i.diffuseColor=new C.Wo(1,0,0),i.specularPower=128;const r=new p.kX(w(),e);r.diffuseColor=new C.Wo(0,0,0);const l=ct(new s.Circle({radius:tt})),c=M(z(tt));c.material=o,l.meshes.push(c);const h=.375*tt,d=M(z(h),{shadows:!1});d.material=i,d.bakeTransformIntoVertices(C.y3.Translation(-(tt+H(h)),0,0)),l.meshes.push(d);const u=t=>{const n=new C.P(-1,.6,.6*(t?-1:1)).normalize(),s=M(tt,{shadows:!1});ht(s,n,.55*tt,e),s.material=a,l.meshes.push(s);const i=M(H(tt),{shadows:!1});ht(i,n,.85*tt,e),i.material=o,l.meshes.push(i);const c=M(.25*tt,{shadows:!1});ht(c,n,tt,e),c.material=r,l.meshes.push(c)};u(!0),u(!1);const m=k(tt,.075,{shadows:!1});ht(m,new C.P(-1,.6,0).normalize(),.3*tt,e),m.bakeTransformIntoVertices(C.y3.RotationZ(.25*Math.PI)),m.material=dt(e),l.meshes.push(m);const f=t=>{const e=.4*tt,n=I(z(e),z(e),{shadows:!1});n.material=o,n.bakeTransformIntoVertices(C.y3.RotationZ(H(Math.PI))),n.bakeTransformIntoVertices(C.y3.RotationY(.125*Math.PI*(t?-1:1))),n.bakeTransformIntoVertices(C.y3.Translation(0,0,.6*tt*(t?-1:1))),l.meshes.push(n)};f(!0),f(!1),n.addShape(l);const y=G({width:nt,height:2*et},0,lt,o);return n.addShape(y,[0,-(tt+H(et))]),n},Mt=function(t,e){const n=new s.Body({mass:.001,position:[t[0],t[1]]}),o=(t=>y.getMaterial(g.VelvetGreen,1,1,.25,t))(e),a=G({width:z(st),height:it},0,lt,o);n.addShape(a);const i=G({width:z(ot),height:at},0,lt,o);return n.addShape(i,[0,-(H(it)+H(at))]),n},kt=function(t,e){const n=new s.RevoluteConstraint(t,e,{localPivotA:[0,H(U)+N+H(q)],localPivotB:[0,.0625-H(Z)]});return n.upperLimitEnabled=!0,n.upperLimit=.05*Math.PI,n.lowerLimitEnabled=!0,n.lowerLimit=-.05*Math.PI,n},Ct=function(t,e){const n=new s.RevoluteConstraint(t,e,{localPivotA:[0,-H(U)],localPivotB:[0,0]});return n.enableMotor(),n.setMotorSpeed(0),n},Bt=function(t,e){const n=new s.RevoluteConstraint(t,e,{localPivotA:[0,-H(_)],localPivotB:[0,H(_)]});return n.lowerLimitEnabled=!0,n.lowerLimit=.2*Math.PI,n},St=function(t,e){return new s.RevoluteConstraint(t,e,{localPivotA:[0,H(_)],localPivotB:[0,H(U)+N+H(q)]})},Lt=function(t,e,n){return new s.RevoluteConstraint(t,e,{localPivotA:[-.175,-.28],localPivotB:[.12*(n?-1:1),0]})},Vt=function(t,e){const n=new s.RevoluteConstraint(t,e,{localPivotA:[0,H(J)],localPivotB:[0,-H(J)]});return n.upperLimitEnabled=!0,n.upperLimit=.7*Math.PI,n.lowerLimitEnabled=!0,n.lowerLimit=.12*Math.PI,n},Rt=function(t,e){const n=new s.RevoluteConstraint(t,e,{localPivotA:[0,H(Z)-H(Q)],localPivotB:[0,H(J)]});return n.upperLimitEnabled=!0,n.upperLimit=.2*Math.PI,n.lowerLimitEnabled=!0,n.lowerLimit=-.3*Math.PI,n},Ot=function(t,e){const n=new s.RevoluteConstraint(t,e,{localPivotA:[0,H(Z)-H(Q)],localPivotB:[0,-(tt+et)]});return n.upperLimitEnabled=!0,n.upperLimit=.05*Math.PI,n.lowerLimitEnabled=!0,n.lowerLimit=-.05*Math.PI,n},Et=function(t,e){return new s.LockConstraint(t,e,{localOffsetB:[0,.75*tt+(H(it)+at)]})},xt=Math.PI/32,At=Math.PI/8,Wt=Math.PI/2;class Gt{constructor(t,e,n){this.direction=null,this.lastActiveTime=0,this.wheelOnTerrain=!1,this.torsoOnTerrain=!1,this.positionHistory=[],this.world=t,this.scene=e;for(let t=1;t<=30;t++)this.positionHistory.push([n[0],n[1]]);const o=this.wheel=ft(n,e),a=this.shaft=yt(n,e),s=this.torso=Tt(n,e);this.shaftWheelConstraint=Ct(a,o),this.shaftTorsoConstraint=kt(a,s),t.addBody(o),t.addBody(a),t.addBody(s),t.addConstraint(this.shaftWheelConstraint),t.addConstraint(this.shaftTorsoConstraint);const i=s=>{const i=gt(n,e,s),r=Pt(n,e,s);t.addBody(i),t.addBody(r),t.addConstraint(Bt(i,r)),t.addConstraint(St(i,a)),t.addConstraint(Lt(r,o,s))};i(!0),i(!1);const r=o=>{const a=vt(n,e,o),i=bt(n,e,o);t.addBody(a),t.addBody(i),t.addConstraint(Vt(i,a)),t.addConstraint(Rt(s,a))};r(!0),r(!1);const l=It(n,e),c=Mt(n,e);t.addBody(l),t.addBody(c),t.addConstraint(Ot(s,l)),t.addConstraint(Et(l,c)),this.addWorldHandlers()}addWorldHandlers(){this.world.on("beginContact",(t=>{Gt.isBodyTerrainContact(this.wheel,t)?this.wheelOnTerrain=!0:Gt.isBodyTerrainContact(this.torso,t)&&(this.torsoOnTerrain=!0)})),this.world.on("endContact",(t=>{Gt.isBodyTerrainContact(this.wheel,t)?this.wheelOnTerrain=!1:Gt.isBodyTerrainContact(this.torso,t)&&(this.torsoOnTerrain=!1)}))}static isBodyTerrainContact(t,e){const n=e.bodyA,o=n.shapes[0].material,a=e.bodyB,s=a.shapes[0].material;return n===t&&s===c.Terrain||a===t&&o===c.Terrain}handlePostWorldStep(t){const e=this.direction;let n=this.shaft.angle%(2*Math.PI);n<-Math.PI?n=2*Math.PI+n:n>Math.PI&&(n=-(2*Math.PI-n));const o=.0375*t,a=Math.abs(n)<xt,s=Math.abs(n)<At,i=Math.abs(n)>Wt&&Math.abs(n)<.75*Math.PI,r=performance.now();null!==e&&(this.lastActiveTime=r);const l=r-this.lastActiveTime;if(this.wheelOnTerrain){if(!i){const t=this.shaftWheelConstraint.getMotorSpeed();let n=0;n=e===A.Left?Math.max(t-o,-8):e===A.Right?Math.min(t+o,8):0,this.shaftWheelConstraint.setMotorSpeed(n)}a?null!==e&&this.torso.applyForce([.05*(e===A.Left?-1:1),0],this.torso.position):i?this.torsoOnTerrain&&null!==e&&(this.shaft.angularForce=30*(n>0?-1:1)):s&&l<1e3&&(this.shaft.angularForce=4*(n>0?-1:1))}this.positionHistory.length>30&&this.positionHistory.splice(0,1),this.positionHistory.push([this.wheel.position[0],this.wheel.position[1]])}}const Xt=function(t){const e=t.bodies;for(let t=0;t<e.length;t++){const n=e[t],o=n.shapes;for(let t=0;t<o.length;t++){const e=o[t],a=e.meshes;if(a){const t=s.vec2.create();s.vec2.rotate(t,e.position,n.angle);const o=s.vec2.create();s.vec2.add(o,n.position,t);for(let t=0;t<a.length;t++){const s=a[t];s.position.x=o[0],s.position.y=o[1];const i=new C.P(0,0,1);s.rotationQuaternion=C._f.RotationAxis(i,n.angle+e.angle)}}}}};class jt{displayLoadingUI(){}hideLoadingUI(){document.getElementById("loading").style.display="none"}}var Ht=n(9456),zt=n(661),Dt=n(6114),Ft=n(4808),Ut=n(2392);const Nt=document.getElementById("viewport");new class{constructor(t){this.lastAnimateTime=performance.now(),this.obliqueView=!0,this.active=!0,this.canvas=t,this.setCanvasSize(),this.world=new s.World,this.world.addContactMaterial(h);const e=new zt.D(t);e.loadingScreen=new jt,e.displayLoadingUI();const n=this.scene=new Dt.x(e);n.clearColor=new C.HE(0,0,0,1),this.camera=new Ht.xc(w(),Ft.P.Zero(),n),y.loadImages(n).then((()=>{this.addInputHandlers(),e.loadingScreen.hideLoadingUI(),this.start()}))}start(){this.terrain=new x(this.world,this.scene),this.player=new Gt(this.world,this.scene,[0,15.37]),this.terrain.handlePreWorldStart(),this.canvas.focus(),this.lastAnimateTime=performance.now(),this.animate(performance.now())}animate(t){if(requestAnimationFrame(this.animate.bind(this)),this.active){let e=t-(this.lastAnimateTime||t);e>500&&(e=0),this.lastAnimateTime=t,this.world.step(1/60,e/1e3,10);const n=e/(1e3/60);this.player.handlePostWorldStep(n),this.terrain.handlePostWorldStep(n,this.player.positionHistory),Xt(this.world)}const e=this.camera,n=this.player.wheel.position;this.obliqueView?(e.position.x=n[0]-4,e.position.y=n[1]+2,e.position.z=-4):(e.position.x=n[0],e.position.y=n[1],e.position.z=-8),e.setTarget(new Ft.P(n[0],n[1],0)),this.scene.render()}setCanvasSize(){const t=this.canvas;t.style.width=window.innerWidth+"px",t.style.height=window.innerHeight+"px"}addInputHandlers(){this.scene.onKeyboardObservable.add((t=>{switch(t.type){case Ut.OG.KEYDOWN:switch(t.event.key){case"ArrowLeft":this.player.direction=A.Left;break;case"ArrowRight":this.player.direction=A.Right}break;case Ut.OG.KEYUP:switch(t.event.key){case"ArrowLeft":case"ArrowRight":this.player.direction=null}}})),this.scene.onPointerObservable.add((t=>{switch(t.type){case Ut.kD.POINTERDOWN:t.event.offsetX<=this.canvas.width/2?this.player.direction=A.Left:this.player.direction=A.Right;break;case Ut.kD.POINTERUP:this.player.direction=null}})),document.getElementById("info-open-button").addEventListener("click",(t=>this.handleOpenInfo(t))),document.getElementById("info-close-button").addEventListener("click",(t=>this.handleCloseInfo(t))),document.getElementById("view-mode-oblique").addEventListener("change",(t=>this.handleViewModeChange(t.target.checked))),document.getElementById("view-mode-side").addEventListener("change",(t=>this.handleViewModeChange(!t.target.checked)))}handleOpenInfo(t){t.preventDefault(),document.getElementById("info-panel").style.display="block",document.getElementById("info-open-button").style.display="none",this.active=!1}handleCloseInfo(t){t.preventDefault(),document.getElementById("info-open-button").style.display="flex",document.getElementById("info-panel").style.display="none",window.setTimeout((()=>{this.active=!0}),500)}handleViewModeChange(t){this.obliqueView=t}}(Nt)}},n={};function o(t){var a=n[t];if(void 0!==a)return a.exports;var s=n[t]={exports:{}};return e[t](s,s.exports,o),s.exports}o.m=e,t=[],o.O=(e,n,a,s)=>{if(!n){var i=1/0;for(h=0;h<t.length;h++){for(var[n,a,s]=t[h],r=!0,l=0;l<n.length;l++)(!1&s||i>=s)&&Object.keys(o.O).every((t=>o.O[t](n[l])))?n.splice(l--,1):(r=!1,s<i&&(i=s));if(r){t.splice(h--,1);var c=a();void 0!==c&&(e=c)}}return e}s=s||0;for(var h=t.length;h>0&&t[h-1][2]>s;h--)t[h]=t[h-1];t[h]=[n,a,s]},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={708:0};o.O.j=e=>0===t[e];var e=(e,n)=>{var a,s,[i,r,l]=n,c=0;if(i.some((e=>0!==t[e]))){for(a in r)o.o(r,a)&&(o.m[a]=r[a]);if(l)var h=l(o)}for(e&&e(n);c<i.length;c++)s=i[c],o.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return o.O(h)},n=self.webpackChunkp2babylonunicycle=self.webpackChunkp2babylonunicycle||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var a=o.O(void 0,[736],(()=>o(8341)));a=o.O(a)})();