/** 
 * I Never Promised You a Rose Garden v1.0.0 - 01-06-2014 
 * Copyright (c) Tom W Hall <tomshalls@gmail.com> 
 */
var Flowers;!function(a){"use strict";var b=function(){function a(a,b){return Math.floor(Math.random()*(b-a+1))+a}function b(a){a=a.replace("#","");var b=parseInt(a,16),c=b>>16&255,d=b>>8&255,e=255&b;return{r:c,g:d,b:e}}function c(a,b,c){return"#"+((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)}function d(a,b,c,d,e,f){var g=d-a,h=e-b,i=c+f;return i*i>=g*g+h*h}return{randomNumber:a,hexToRgb:b,rgbToHex:c,circlesTouchOrOverlap:d}}();a.util=b}(Flowers||(Flowers={}));var Level={Easy:1,Medium:2,Hard:3},State={Initial:1,PlayerTurn:2,ComputerTurn:3,Growth:4,GameOverPlayerWon:5,GameOverComputerWon:6,GameOverDraw:7},Flowers;!function(a){var b=function(){function b(b,c){this.x=b,this.y=c,this.radius=0,this.rotation=a.util.randomNumber(0,359),this.blockedByBoundary=!1,this.touchingPlants=[]}return b}();a.Plant=b}(Flowers||(Flowers={}));var Flowers;!function(a){var b=function(){function a(a,b,c){this.x=a,this.y=b,this.radius=c}return a}();a.SimPlant=b}(Flowers||(Flowers={}));var Flowers;!function(a){var b=function(){function a(a,b){this.x=a,this.y=b}return a}();a.Position=b}(Flowers||(Flowers={}));var Flowers;!function(a){var b=function(){function b(b,c){a.Plant.call(this,b,c),this.isCritical=!1}return b}();b.prototype=Object.create(a.Plant.prototype),a.Flower=b}(Flowers||(Flowers={})),ko.bindingHandlers.tap={init:function(a,b,c,d){var e=c().tap;Hammer(a).on("tap",function(a){e(d,a)})},update:function(){}};var Flowers;!function(a){var b=function(){function b(b,c,d){a.SimPlant.call(this,b,c,d)}return b}();b.prototype=Object.create(a.SimPlant.prototype),a.SimFlower=b}(Flowers||(Flowers={}));var Flowers;!function(a){"use strict";var b=function(){function b(){this.flowers=[],this.weeds=[],this.lastPulledWeedPosition=null}return b.prototype.clone=function(){for(var b,c,d=new a.SimGame,e=this.flowers,f=e.length,g=this.weeds,h=g.length;f--;)b=e[f],d.flowers.push(new a.SimFlower(b.x,b.y,b.radius));for(;h--;)c=g[h],d.weeds.push(new a.SimWeed(c.x,c.y,c.radius));return null!==this.lastPulledWeedPosition&&(d.lastPulledWeedPosition=new a.Position(this.lastPulledWeedPosition.x,this.lastPulledWeedPosition.y)),d},b.prototype.plants=function(){return this.flowers.concat(this.weeds)},b.prototype.flowerCoverage=function(){for(var a,b=0,c=this.flowers,d=c.length;d--;)a=c[d].radius,b+=3.1415*a*a;return b/589824*100},b.prototype.weedCoverage=function(){for(var a,b=0,c=this.weeds,d=c.length;d--;)a=c[d].radius,b+=3.1415*a*a;return b/589824*100},b.prototype.growPlants=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o=this.plants(),p=o.length,q=this.flowers.length,r=this.weeds.length,s=0;for(b=48;b--&&p>s;){for(s=0,g=[],c=p;c--;){if(h=o[c],l=h.radius,m=!(h.x-l<=0||h.x+l>=768||h.y-l<=0||h.y+l>=768))for(d=p;d--;)if(i=o[d],i!==h&&a.util.circlesTouchOrOverlap(h.x,h.y,l,i.x,i.y,i.radius)){m=!1;break}m?h.radius++:s++}for(e=q;e--;)for(j=this.flowers[e],n=0,f=r;f--&&3>n;)k=this.weeds[f],a.util.circlesTouchOrOverlap(j.x,j.y,j.radius,k.x,k.y,k.radius)&&(n++,n>=3&&(this.flowers.splice(c,1),q=this.flowers.length,o=this.plants(),p=o.length))}},b}();a.SimGame=b}(Flowers||(Flowers={}));var Flowers;!function(a){var b=function(){function b(b,c,d){a.SimPlant.call(this,b,c,d)}return b}();b.prototype=Object.create(a.SimPlant.prototype),a.SimWeed=b}(Flowers||(Flowers={}));var Flowers;!function(a){var b=function(){function b(b,c,d){a.Position.call(this,b,c,d),this.weighting=d}return b.prototype=Object.create(a.Position.prototype),b}();a.WeightedPosition=b}(Flowers||(Flowers={}));var Flowers;!function(a){"use strict";var b=function(){function b(b,c,d){for(var e,f=d.length,g=f;g--;)if(e=d[g],a.util.circlesTouchOrOverlap(b,c,0,e.x,e.y,e.radius))return!1;return!0}function c(c,d){var e,f,g,h,i,j,k,l,m=c.plants(),n=m.length;for(f=0;672>f;)for(f+=96,e=0;672>e;)if(e+=96,a.util.circlesTouchOrOverlap(e,f,48,d.x,d.y,d.radius)&&b(e,f,m)){for(i=c.clone(),j=_.findWhere(i.flowers,{x:d.x,y:d.y}),l=new a.SimWeed(e,f,0),i.weeds.push(l),h=!1,g=n;g--;)if(k=m[g],k!==l&&k!==d&&a.util.circlesTouchOrOverlap(e,f,47,k.x,k.y,k.radius+48)){h=!0;break}if(!h)return!0;if(i.growPlants(),!_.contains(i.flowers,j))return!0}return!1}function d(e,f,g){function h(b){return-(1e3*b.weighting+a.util.randomNumber(1,100))}var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=[],E=e.plants();for(l=0;672>l;)for(l+=96,j=96===l||672===l,k=0;672>k;)if(k+=96,i=96===k||672===k,(null===e.lastPulledWeedPosition||k!==e.lastPulledWeedPosition.x||l!==e.lastPulledWeedPosition.y)&&b(k,l,E)){for(o=e.clone(),r=new a.SimWeed(k,l,0),o.weeds.push(r),o.lastPulledWeedPosition=null,o.growPlants(),v=o.flowerCoverage(),w=o.weedCoverage(),x=w/(v>0?v:1),y=1,j&&i?y+=1.5:(j||i)&&(y+=1),y+=10*(e.flowers.length-o.flowers.length),z=[],m=o.flowers.length;m--;){for(q=o.flowers[m],B=0,n=o.weeds.length;n--;)s=o.weeds[n],a.util.circlesTouchOrOverlap(q.x,q.y,q.radius,s.x,s.y,s.radius)&&B++;1===B?y+=q.radius/96*3:2===B&&z.push(q)}if(z.length>0){for(A=0,m=z.length;m--&&(C=z[m],!c(o,C)||(A++,2!==A)););2===A?y+=7*A:1===A&&(y+=4)}y>1&&(x*=y),2>f&&o.flowers.length===e.flowers.length&&(p=o.clone(),u=d(p,f+1,g),null!==u&&(x=(2*x+u.weighting)/3)),D.push(new a.WeightedPosition(k,l,x)),D=_.sortBy(D,h)}if(t=null,D.length>0)switch(g){case Level.Easy:t=D.length>36?D[a.util.randomNumber(0,7)]:D.length>18?D[a.util.randomNumber(0,3)]:D.length>9?D[a.util.randomNumber(0,2)]:D.length>6?D[a.util.randomNumber(0,1)]:D[0];break;case Level.Medium:t=D.length>36?D[a.util.randomNumber(0,3)]:D.length>18?D[a.util.randomNumber(0,2)]:D.length>9?D[a.util.randomNumber(0,1)]:D[0];break;case Level.Hard:t=D.length>42?D[a.util.randomNumber(0,2)]:D[0];break;default:throw new Error("Unrecognized difficulty level")}return t}function e(a,b){return d(a,1,b)}return{getComputerBestPosition:e}}();a.computerPlayer=b}(Flowers||(Flowers={}));var Flowers;!function(a){var b=function(){function b(b,c){a.Plant.call(this,b,c)}return b}();b.prototype=Object.create(a.Plant.prototype),a.Weed=b}(Flowers||(Flowers={}));var Flowers;!function(a){"use strict";var b=function(){function b(){T=document.getElementsByTagName("body")[0],U=document.getElementById("left-column"),V=document.getElementById("right-column"),Cb.src="images/soil.png",h(),window.addEventListener("resize",h),cb.subscribe(j),z(),gb("To start, click on a spot in the garden to plant your first flower.<br>Click the ? icon for instructions."),d(),createjs.Sound.initializeDefaultPlugins()?(createjs.Sound.addEventListener("fileload",c),createjs.Sound.registerManifest(Jb,"sounds/")):console.log("Unable to initialize sounds")}function c(){Lb++,Lb===Kb&&f()}function d(){var a,b=[];for(a=0;a<Gb.length;a++)b[a]=new Image,b[a].src="images/"+Gb[a],b[a].onload=e}function e(){Ib++,Ib===Hb&&f()}function f(){Lb===Kb&&Ib===Hb&&g()}function g(){ko.applyBindings(a.game),window.setTimeout(N,15),document.getElementById("loading").style.display="none",document.getElementById("game-info").style.display="block"}function h(){var a,b=U,c=V,d=window.innerWidth,e=window.innerHeight;wb=e/768,xb=Math.round((d-1184*wb)/2),T.setAttribute("style","font-size: "+Math.round(20*wb)+"px"),b.style.width=e+"px",b.style.height=e+"px",b.style.left=xb+"px",c.style.left=e+"px",c.style.width=Math.round(416*wb)+"px",c.style.height=e+"px",c.style.left=xb+e+"px",a=e*Db,yb.setAttribute("width",a),yb.setAttribute("height",a),Ab.setAttribute("width",a),Ab.setAttribute("height",a),S(!0)}function i(b){var c=b.gesture.touches[0],d=Math.round((c.pageX-xb)/wb),e=Math.round(c.pageY/wb);return new a.Position(d,e)}function j(a){switch(a){case State.PlayerTurn:r();break;case State.ComputerTurn:s();break;case State.Growth:p();break;case State.GameOverPlayerWon:C();break;case State.GameOverComputerWon:D();break;case State.GameOverDraw:E()}}function k(){return W.concat(X)}function l(){var a,b,c=k();for(b=768;b-=96;)for(a=768;a-=96;)if(m(a,b,c))return!0;return!1}function m(a,b,c){var d,e,f,g,h,i,j;if(96>a||a>672||96>b||b>672)return!1;for(d=c||k(),e=d.length,f=e;f--;){if(g=d[f],g.x===a&&g.y===b)return!1;if(h=g.x-a,i=g.y-b,j=g.radius,j*j>=h*h+i*i)return!1}return!0}function n(){var b,c,d,e,f,g,h,i,j,l,m,n,o,p,q,r=W,s=k(),t=r.length,u=s.length,v=0,w=0,x=!1;for(ib++,48===ib&&window.clearInterval(hb),b=u;b--;){for(f=s[b],d=f.x,e=f.y,i=f.radius,j=f.touchingPlants,m=!0,f.blockedByBoundary||(0>=d-i||d+i>=768||0>=e-i||e+i>=768)&&(f.blockedByBoundary=!0),f.blockedByBoundary&&(m=!1),c=u;c--;)g=s[c],g!==f&&-1===j.indexOf(g)&&(n=g.x-d,o=g.y-e,p=i+g.radius,p*p>=n*n+o*o&&(j.push(g),-1===g.touchingPlants.indexOf(f)&&g.touchingPlants.push(f)));if(j.length>0&&(m=!1),m&&(f.radius++,i=f.radius),f instanceof a.Flower?v+=i*i:w+=i*i,48===ib)for(c=u;c--;)g=s[c],g!==f&&-1===j.indexOf(g)&&(n=g.x-d,o=g.y-e,p=i+g.radius,p*p>=n*n+o*o&&(j.push(g),-1===g.touchingPlants.indexOf(f)&&g.touchingPlants.push(f)))}for(b=t;b--;)if(h=r[b],h.touchingPlants.length>=2)for(l=0,c=h.touchingPlants.length;c--;){if(f=h.touchingPlants[c],f instanceof a.Weed&&l++,l>=3){R("flowerZapped"),W.splice(W.indexOf(h),1),v-=i*i,y(h),x=!0;break}2===l&&(h.isCritical=!0,x=!0)}Y=3.1415*v/589824*100,Z=3.1415*w/589824*100,$(Math.round(Y)),ab(Math.round(Z)),z(),q=(new Date).getTime(),(x||1===ib||48===ib||24>=q-jb)&&(Fb||(Fb=!0,window.requestAnimationFrame(function(){S(x)}))),jb=q,48===ib&&(ib=0,cb(State.PlayerTurn))}function o(){hb=window.setInterval(n,21)}function p(){gb("Photosynthesizing!"),window.setTimeout(o,300)}function q(){var a,b,c=W,d=X,e=0,f=0;for(a=c.length;a--;)b=c[a].radius,e+=b*b;for(Y=3.1415*e/589824*100,a=d.length;a--;)b=d[a].radius,f+=b*b;Z=3.1415*f/589824*100,$(Math.round(Y)),ab(Math.round(Z))}function r(){var a,b,c;return Pb()?void A():(bb(bb()+1),a=l(),b=X.length>0&&null===eb,a?(c="",c+=Pb()?"Your last turn!":"Your turn.",c+=" You ",c+=b?"can plant a flower or pull up a weed":1===bb()?"can plant a flower anywhere you like":"must plant a flower today",c+=".",void gb(c)):void A())}function s(){gb("My turn! Thinking..."),window.setTimeout(t,50)}function t(){var b,c,d,e,f;d=(new Date).getTime(),b=v(),c=a.computerPlayer.getComputerBestPosition(b,db()),e=(new Date).getTime(),f=e-d,250>f?window.setTimeout(function(){u(c)},250-f):u(c)}function u(b){null===b?A():(R("plantSeed"),X.push(new a.Weed(b.x,b.y)),z(),S(!1),cb(State.Growth))}function v(){var b,c,d,e=new a.SimGame,f=W,g=X;for(b=f.length;b--;)c=f[b],e.flowers.push(new a.SimFlower(c.x,c.y,c.radius));for(b=g.length;b--;)d=g[b],e.weeds.push(new a.SimWeed(d.x,d.y,d.radius));return null!==eb&&(e.lastPulledWeedPosition=new a.Position(eb.x,eb.y)),e}function w(b,c){var d,e,f,g,h,j,l,n,o,p,r,s,t=cb();if(t===State.Initial)cb(State.PlayerTurn);else if(t!==State.PlayerTurn)return R("invalid"),void((t===State.ComputerTurn||t===State.Growth)&&gb("Give it thyme, it'll be your turn soon..."));for(d=i(c),e=new a.Position(96*Math.round(d.x/96),96*Math.round(d.y/96)),o=null,h=k(),j=h.length;j--;)if(r=h[j],a.util.circlesTouchOrOverlap(d.x,d.y,0,r.x,r.y,r.radius)){o=r;break}if(null===o||o instanceof a.Flower)for(f=X,g=f.length,j=g;j--;)if(s=f[j],s.x===e.x&&s.y===e.y&&s.radius<=15){o=s;break}null!==o?o instanceof a.Flower?R("invalid"):null!==eb?(gb("Sorry, you pulled up a weed on your last turn."),R("invalid")):(p=o,R("removeWeed"),eb=new a.Position(p.x,p.y),X.splice(X.indexOf(p),1),z(),q(),x(),y(p),S(!0),cb(State.ComputerTurn)):(l=96*Math.round(d.x/96),n=96*Math.round(d.y/96),m(l,n)?(R("plantSeed"),W.push(new a.Flower(l,n)),eb=null,z(),S(!1),cb(State.ComputerTurn)):R("invalid"))}function x(){var b,c,d,e,f,g=W,h=X,i=g.length,j=h.length;for(b=i;b--;){for(d=g[b],f=0,c=j;c--&&(e=h[c],!a.util.circlesTouchOrOverlap(d.x,d.y,d.radius,e.x,e.y,e.radius)||(f++,2!==f)););d.isCritical=2===f}}function y(a){for(var b,c,d=k(),e=d.length,f=e;f--;)b=d[f],c=b.touchingPlants.indexOf(a),-1!==c&&b.touchingPlants.splice(c,1)}function z(){var b,c,d,e,f,g,h,i,j,l=k(),m=l.length;for(fb.length=0,d=768;d-=96;)for(c=768;c-=96;){for(j=!0,b=m;b--;){if(e=l[b],e.x===c&&e.y===d){j=!1;break}if(f=e.x-c,g=e.y-d,h=e.radius,i=f*f+g*g,h*h>=i){j=!1;break}}j&&fb.push(new a.Position(c,d))}}function A(){window.requestAnimationFrame(B),cb(Y>Z?State.GameOverPlayerWon:Z>Y?State.GameOverComputerWon:State.GameOverDraw)}function B(){$(Y.toFixed(1)),ab(Z.toFixed(1))}function C(){R("gameOverWon"),gb("You've hit pay dirt!"),S(!0)}function D(){R("gameOverLost"),gb("I win. How irrigating!"),S(!0)}function E(){R("gameOverDraw"),gb("It's a draw! We're evenly mulched."),S(!0)}function F(){return ub(!ub()),!1}function G(a){return ub(!1),a!==db()&&(db(a),Q()),!1}function H(){sb(!sb())}function I(){var a=cb();a>=2&&4>=a&&(2!==a||1!==bb())?vb(!vb()):(a===State.GameOverPlayerWon&&db()<Level.Hard&&db(db()+1),Q())}function J(){vb(!vb())}function K(){vb(!1),Q()}function L(){tb(!tb())}function M(b){var c=a.util.hexToRgb(b),d=Math.ceil(.75*c.r),e=Math.ceil(.75*c.g),f=Math.ceil(.75*c.b),g=a.util.rgbToHex(d,e,f),h=Math.ceil(.5*c.r),i=Math.ceil(.5*c.g),j=Math.ceil(.5*c.b),k=a.util.rgbToHex(h,i,j),l=Math.ceil(.25*c.r),m=Math.ceil(.25*c.g),n=Math.ceil(.25*c.b),o=a.util.rgbToHex(l,m,n);lb(b),mb(g),nb(k),ob(g),pb(k),qb(o),S(!0)}function N(){M(kb)}function O(a){return a===lb()}function P(){Mb()&&R("stopSound"),Mb(!Mb())}function Q(){window.clearInterval(hb),W.length=0,X.length=0,Y=0,Z=0,$(0),ab(0),bb(0),eb=null,z(),Eb.length=0,Fb=!1,S(!0),cb(-1),cb(State.PlayerTurn)}function R(a){var b;Mb()&&(b=_.filter(Jb,function(b){return b.id===a}),1===b.length&&createjs.Sound.play("sounds/"+b[0].src))}function S(b){function c(a){a.save(),a.fillStyle="#d5b87e",a.beginPath(),a.moveTo(0,-15),a.bezierCurveTo(5.52,-15,10,-8.28,10,0),a.bezierCurveTo(10,8.28,5.52,15,0,15),a.bezierCurveTo(-5.52,15,-10,8.28,-10,0),a.bezierCurveTo(-10,-8.28,-5.52,-15,0,-15),a.closePath(),a.fill(),a.stroke(),a.restore()}function d(a,b){var d=b.radius,e=.01*d;a.save(),a.translate(b.x,b.y),a.rotate(b.rotation),c(a,b),a.save(),a.scale(e,e),a.fillStyle=u===State.GameOverPlayerWon||u===State.GameOverDraw?"#f9e427":b.isCritical?"#013611":"#016e24",a.strokeStyle="#000000",a.lineWidth=1,a.beginPath(),a.moveTo(-99,28),a.bezierCurveTo(-99,28,-72,19,-56,-1),a.lineTo(-30,3),a.lineTo(-35,28),a.lineTo(-51,31),a.bezierCurveTo(-51,31,-76,25,-99,28),a.closePath(),a.moveTo(-59,-84),a.bezierCurveTo(-59,-84,-39,-63.8,-14,-58.3),a.lineTo(-6.07,-33.2),a.lineTo(-26.27,-22.1),a.lineTo(-40.47,-39.6),a.bezierCurveTo(-40.47,-39.6,-46.17,-64.7,-59.07,-83.9),a.closePath(),a.moveTo(64,-83),a.bezierCurveTo(64,-83,46.1,-60.8,43.5,-35.4),a.lineTo(19.4,-24.7),a.lineTo(6.1,-43.5),a.lineTo(21.9,-59.6),a.bezierCurveTo(21.9,-59.6,46.2,-68.05,63.9,-83),a.closePath(),a.moveTo(95,36),a.bezierCurveTo(95,36,68.9,24.6,43.6,28.8),a.lineTo(26.9,8.4),a.lineTo(41.5,-9.4),a.lineTo(61.2,1.6),a.bezierCurveTo(61.2,1.6,75.8,22.8,94.9,35.9),a.closePath(),a.moveTo(-7,103),a.bezierCurveTo(-7,103,-5.79,74.6,-18.8,52.5),a.lineTo(-5.8,29.6),a.lineTo(16,36.85),a.lineTo(12.84,59.15),a.bezierCurveTo(12.84,59.15,-1.66,80.35,-7.06,102.95),a.closePath(),a.fill(),a.stroke(),a.lineWidth=3,a.fillStyle=u===State.GameOverPlayerWon||u===State.GameOverDraw?"#f9e427":b.isCritical?p:o,a.beginPath(),a.moveTo(3,-94),a.bezierCurveTo(-9.5,-94.22,-24.4,-99.23,-34.8,-89.61),a.bezierCurveTo(-43.99,-80.54,-43.65,-65.61,-39.57,-54.21),a.bezierCurveTo(-34.06,-44.55,-19.27,-42.11,-18.07,-29.71),a.bezierCurveTo(-27.86,-20.03,-36.77,-37.85,-36.97,-46.61),a.bezierCurveTo(-40.62,-61.71,-59.27,-68.51,-72.97,-63.81),a.bezierCurveTo(-85.07,-58.81,-85.37,-44.31,-86.07,-33.21),a.bezierCurveTo(-86.31,-20.61,-97.27,-10.31,-94.36,2.59),a.bezierCurveTo(-91.56,20.49,-64.76,26.19,-54.66,11.37),a.bezierCurveTo(-50.81,.47,-24.46,8.02,-36.76,17.63),a.bezierCurveTo(-48.66,22.23,-63.66,14.7,-73.66,24.59),a.bezierCurveTo(-83.96,34.59,-84.26,52.59,-75.77,63.79),a.bezierCurveTo(-67.36,70.71,-53.47,70.96,-48.77,82.19),a.bezierCurveTo(-37.17,95.39,-14.77,89.7,-5.67,76.39),a.bezierCurveTo(3.55,65.99,-4.07,53.99,-5.69,42.89),a.bezierCurveTo(-7.8,34.65,5.51,29.99,3.47,40.82),a.bezierCurveTo(2.16,52.92,-2.12,65.32,2.34,77.42),a.bezierCurveTo(4.54,87.42,13.84,95.22,24.34,93.52),a.bezierCurveTo(35.44,93.19,46.14,87.1,51.34,77.32),a.bezierCurveTo(58.96,68.86,73.44,67.02,76.54,54.62),a.bezierCurveTo(80.74,42.82,75.34,26.82,62.04,23.92),a.bezierCurveTo(53.11,18.98,35.44,28.01,33.24,14.46),a.bezierCurveTo(35.38,1.36,49.84,7.62,54.34,15.64),a.bezierCurveTo(61.56,26.14,74.64,23.67,84.44,18.88),a.bezierCurveTo(96.24,15.26,100.34,1.28,96.24,-9.42),a.bezierCurveTo(89.23,-18.64,87.7,-29.32,87.6,-40.82),a.bezierCurveTo(85.05,-55.82,68.2,-66.32,53.7,-61.22),a.bezierCurveTo(40.8,-58.39,33.1,-45.92,32.7,-33.42),a.bezierCurveTo(27.56,-23.22,13.1,-31.74,23.74,-39.29),a.bezierCurveTo(32.43,-48.01,44.94,-55.19,46.54,-68.59),a.bezierCurveTo(47.96,-83.29,33.74,-94.79,19.94,-95.59),a.bezierCurveTo(14.94,-95.59,8.94,-95.59,3.94,-93.59),a.closePath(),a.fill(),a.stroke(),a.lineWidth=2,a.fillStyle=u===State.GameOverPlayerWon||u===State.GameOverDraw?"#f9e427":b.isCritical?r:q,a.beginPath(),a.moveTo(2,-66),a.bezierCurveTo(13.2,-63.65,20.6,-82.2,31.8,-74.12),a.bezierCurveTo(41.72,-65.35,31.11,-50.42,20.7,-48.02),a.bezierCurveTo(11.39,-43.75,6.8,-28.12,17.2,-22.42),a.bezierCurveTo(28.1,-14.28,37.5,-28.51,39.7,-38.02),a.bezierCurveTo(42.55,-49.12,61.3,-54.22,63.9,-40.61),a.bezierCurveTo(64.18,-30.51,57.92,-17.61,68.32,-10.31),a.bezierCurveTo(78.92,-6.17,79.92,13.39,66.47,12.89),a.bezierCurveTo(56.17,12.594,52.67,1.29,43.97,-1.71),a.bezierCurveTo(33.47,-4.59,22.17,6.69,26.27,17.19),a.bezierCurveTo(30.77,28.19,44.67,23.88,53.77,26.51),a.bezierCurveTo(66.87,27.47,67.57,47.21,54.7,49.31),a.bezierCurveTo(44.5,50.32,33.2,52.36,31.1,64.41),a.bezierCurveTo(27.82,76.01,11.4,77.51,6.7,66.39),a.bezierCurveTo(.99,55.69,11.96,46.39,11.06,36.19),a.bezierCurveTo(9.22,24.09,-8.24,23.39,-10.74,35.266),a.bezierCurveTo(-13.84,45.97,-6.99,58.366,-14.52,67.97),a.bezierCurveTo(-25.52,77.876,-34.82,62.4,-38.52,53.37),a.bezierCurveTo(-44.75,43.87,-59.72,48.29,-64.42,37.37),a.bezierCurveTo(-69.261,27.37,-56.42,21.97,-48.32,23.77),a.bezierCurveTo(-40.49,24.38,-30.12,25.03,-26.02,16.74),a.bezierCurveTo(-18.78,4.54,-35.64,-7.56,-46.52,-.56),a.bezierCurveTo(-54.79,3.04,-72.02,14.24,-74.92,-.69),a.bezierCurveTo(-74.26,-10.62,-63.32,-14.99,-59.62,-23.19),a.bezierCurveTo(-58.4,-31.923,-63.62,-47.99,-50.28,-48.99),a.bezierCurveTo(-36.18,-46.61,-41.7,-27.29,-31.28,-21.19),a.bezierCurveTo(-21.59,-14.73,-10.48,-25,-13.18,-35.29),a.bezierCurveTo(-15.12,-46.29,-25.78,-52.09,-31.98,-60.39),a.bezierCurveTo(-38.66,-72.193,-22,-82.4,-12.38,-75.2),a.bezierCurveTo(-7.3,-72.78,-3.13,-68.9,1.72,-66.1),a.closePath(),a.fill(),a.stroke(),a.lineWidth=1,a.fillStyle=u===State.GameOverPlayerWon||u===State.GameOverDraw?"#f9e427":b.isCritical?t:s,a.beginPath(),a.moveTo(3,-65),a.bezierCurveTo(-.39,-52.8,-6.98,-42,-13,-31),a.bezierCurveTo(-12.773,-17.3,-29,-18.3,-37.3,-21.63),a.bezierCurveTo(-42.67,-20.27,-57.9,-21.33,-56.9,-18),a.bezierCurveTo(-46.96,-12.16,-39.4,-2.9,-28.7,1.7),a.bezierCurveTo(-17.8,12,-32.06,22.2,-33.8,32.6),a.bezierCurveTo(-34.285,37.67,-42.62,52.5,-33.7636,43.6),a.bezierCurveTo(-24.77,37.64,-13.26,35.86,-5.56,27.8),a.bezierCurveTo(6.74,23.86,14.64,38.1,25.64,41),a.bezierCurveTo(29.28,43.08,40.8364,56.4,35.1664,45.18),a.bezierCurveTo(32.31,36.13,33.69,25.28,26.59,17.98),a.bezierCurveTo(21.39,5.28,35.95,-1.02,43.9864,-6.62),a.bezierCurveTo(47.32,-10.89,60.09,-16.82,57.9864,-19.02),a.bezierCurveTo(47.49,-18.1,36.79,-23.66,26.59,-20.29),a.bezierCurveTo(12.29,-19.16,10.69,-34.99,8.59,-44.69),a.bezierCurveTo(6.59,-51.69,3.59,-58.69,3.59,-65.69),a.closePath(),a.fill(),a.stroke(),a.fillStyle=u===State.GameOverPlayerWon||u===State.GameOverDraw?"#f9e427":b.isCritical?"#7d7214":"#f9e427",a.lineCap="round",a.beginPath(),a.arc(0,-18,12,0,6.283185307179586,!0),a.fill(),a.stroke(),a.beginPath(),a.arc(-18,-6,12,0,6.283185307179586,!0),a.fill(),a.stroke(),a.beginPath(),a.arc(18,-6,12,0,6.283185307179586,!0),a.fill(),a.stroke(),a.beginPath(),a.arc(-11,15,12,0,6.283185307179586,!0),a.fill(),a.stroke(),a.beginPath(),a.arc(11,15,12,0,6.283185307179586,!0),a.fill(),a.stroke(),a.beginPath(),a.arc(0,0,12,0,6.283185307179586,!0),a.fill(),a.stroke(),a.restore(),a.lineWidth=2,a.strokeStyle=u===State.GameOverPlayerWon||u===State.GameOverDraw?"#f9e427":"#ffbda3",a.beginPath(),a.arc(0,0,d,0,6.283185307179586,!0),a.stroke(),a.restore()}function e(a,b){var d=b.radius,e=.00365*d;a.save(),a.translate(b.x,b.y),a.rotate(b.rotation),c(a,b),a.save(),a.scale(e,e),a.fillStyle=u===State.GameOverComputerWon||u===State.GameOverDraw?"#f9e427":"#00892c",a.beginPath(),a.arc(0,0,100,0,6.283185307179586,!0),a.closePath(),a.fill(),a.stroke(),a.lineWidth=3,a.fillStyle=u===State.GameOverComputerWon||u===State.GameOverDraw?"#f9e427":"#007024",a.beginPath(),a.moveTo(11,-36),a.bezierCurveTo(14.89,-70.1,-31.7,-88.8,-20.8,-123.9),a.bezierCurveTo(-18.34,-162.2,19.5,-181.8,48.1,-200),a.bezierCurveTo(67.1,-210.5,84.1,-229.3,95.1,-245.8),a.bezierCurveTo(71.1,-193.2,106.1,-134.8,87.1,-81.8),a.bezierCurveTo(69.1,-45.8,8.1,-46.8,4.1,.2),a.moveTo(40,10),a.bezierCurveTo(74.1,13.79,92.7,-32.8,127.8,-22),a.bezierCurveTo(165.9,-19.7,185.4,17.9,203.8,46.2),a.bezierCurveTo(210.13,61.9,244.2,88.4,244.7,90.2),a.bezierCurveTo(192.9,71,137.7,104.2,85.7,84.96),a.bezierCurveTo(49.7,65.96,49.7,4.96,2.7,2.96),a.moveTo(-36,-8),a.bezierCurveTo(-70.1,-11.65,-88.5,35.1,-123.7,24.3),a.bezierCurveTo(-161.7,22.3,-181.1,-14.7,-199.6,-43.7),a.bezierCurveTo(-210.5,-61.7,-228.7,-77.7,-245.6,-89.7),a.bezierCurveTo(-192.1,-65.7,-132.6,-104.7,-79.6,-81.7),a.bezierCurveTo(-45.6,-61.7,-44.6,-3.7,1.4,.3),a.moveTo(-7,36),a.bezierCurveTo(-12.19,69.9,33.7,90.4,21.4,125),a.bezierCurveTo(17.2,164.2,-22.6,182.4,-52.9,199.3),a.bezierCurveTo(-69.3,205.86,-99.2,239.9,-98,240.5),a.bezierCurveTo(-73.3,188.9,-106.11,130.5,-84.7,78.5),a.bezierCurveTo(-63.7,43.5,-4.7,45.5,2.3,-.5),a.moveTo(36,-18),a.bezierCurveTo(63.7,-38.3,45.56,-85.2,78.8,-101.1),a.bezierCurveTo(108.4,-125.2,148.2,-110.75,180.8,-102.34),a.bezierCurveTo(196.2,-94.99,239.5,-98.78,241,-97.65),a.bezierCurveTo(190.1,-76.75,171.8,-15.05,121,6.35),a.bezierCurveTo(82.1,16.25,44,-24.35,6,-1.79),a.bezierCurveTo(4.6,-.89,3.19,.01,1.79,.91),a.moveTo(22,34),a.bezierCurveTo(42.3,61.6,89.3,43.46,105.1,76.7),a.bezierCurveTo(129.3,106.3,115,146.1,106.65,178.7),a.bezierCurveTo(100.38,199.4,100.75,223.7,104.02,243.9),a.bezierCurveTo(85.32,188.4,16.52,170.8,-1.98,115.9),a.bezierCurveTo(-9.5,78,28.92,40.3,5.42,3.9),a.lineTo(4.42,-.1),a.moveTo(-17,-34),a.bezierCurveTo(-37.5,-61.7,-84.8,-43.24,-100.6,-76.8),a.bezierCurveTo(-125.3,-107.4,-109.94,-148.1,-101.89,-181.8),a.bezierCurveTo(-95.18,-198.1,-98.11,-244.3,-99.78,-243.1),a.bezierCurveTo(-80.68,-189.3,-15.98,-171.6,6.22,-120.1),a.bezierCurveTo(17.52,-81.7,-23.48,-43.6,-.49,-6.1),a.lineTo(2.51,-2.1),a.moveTo(-29,18),a.bezierCurveTo(-57.4,37.2,-41.1,84.8,-74.9,99.3),a.bezierCurveTo(-105.3,122.3,-144.4,106.57,-176.9,97),a.bezierCurveTo(-197,89.95,-222.4,89.12,-241.5,91.51),a.bezierCurveTo(-185.6,75.51,-165.3,9.01,-111.5,-9.49),a.bezierCurveTo(-73.9,-17.77,-39.5,23.01,-2.5,4.01),a.lineTo(2.5,2.01),a.lineTo(6.5,-.99),a.fill(),a.stroke(),a.lineWidth=4,a.fillStyle=u===State.GameOverComputerWon||u===State.GameOverDraw?"#f9e427":"#007d28",a.beginPath(),a.moveTo(-4,-36),a.bezierCurveTo(-13.63,-68.7,-63.5,-68.4,-67,-104.8),a.bezierCurveTo(-80.3,-140.9,-52.3,-173.3,-33.2,-201.1),a.bezierCurveTo(-21.3,-212.8,-9.9,-254.4,-8.9,-255.7),a.bezierCurveTo(-6.69,-200.7,45,-162.4,47.4,-107.7),a.bezierCurveTo(44.4,-66.7,-12.6,-42.7,3.4,1.3),a.moveTo(41,-5),a.bezierCurveTo(73.9,-14.68,72.9,-65,109.5,-68.5),a.bezierCurveTo(145.5,-81.1,178.1,-54,205.9,-35),a.bezierCurveTo(217.8,-22.9,259.5,-11.8,260.6,-10.2),a.bezierCurveTo(205.5,-7.85,167.2,44.2,112.6,46.3),a.bezierCurveTo(72.5,42.1,50.3,-8,7.6,.1),a.bezierCurveTo(6.57,.29,5.53,.47,4.5,.66),a.moveTo(-36,7),a.bezierCurveTo(-68.9,16.77,-67.8,67,-104.4,70.7),a.bezierCurveTo(-141.6,83.7,-174.7,55.1,-203.6,35.8),a.bezierCurveTo(-217,23.8,-260.5,10.8,-260.4,11.8),a.bezierCurveTo(-203.2,12.8,-164.4,-42.2,-107.4,-45.2),a.bezierCurveTo(-67.4,-42.2,-44.404,12.8,.6,-.2),a.moveTo(8,37),a.bezierCurveTo(16.29,70.3,66.6,71.3,68.6,108),a.bezierCurveTo(79.7,144.5,51.4,175.9,31.2,202.9),a.bezierCurveTo(18.6,213.9,5.9,255.9,4.3,256.9),a.bezierCurveTo(4.5,199.9,-49.1,158.9,-45.6,102.9),a.bezierCurveTo(-38.5,66.4,8.1,48.2,3.8,8.5),a.lineTo(2.8,4.5),a.lineTo(1.8,-.5),a.fill(),a.stroke(),a.lineWidth=5,a.fillStyle=u===State.GameOverComputerWon||u===State.GameOverDraw?"#f9e427":"#00892c",a.beginPath(),a.moveTo(26,-30),a.bezierCurveTo(43.7,-59.4,8.8,-95.7,33.35,-123.1),a.bezierCurveTo(51.25,-156.8,93.55,-159.1,126.95,-163.9),a.bezierCurveTo(148.45,-166.02,170.75,-175.8,188.15,-186.4),a.bezierCurveTo(145.25,-148.2,153.65,-81.4,114.15,-40.4),a.bezierCurveTo(83.15,-15.7,34.35,-37.66,7.15,-5.3),a.closePath(),a.moveTo(33,24),a.bezierCurveTo(62.5,41.5,98.6,6.6,126.1,31.07),a.bezierCurveTo(160,48.97,161.9,91.37,167.5,124.67),a.bezierCurveTo(167.068,141.47,187,180.27,186.9,181.77),a.bezierCurveTo(148.9,142.77,85.9,149.77,45.9,112.77),a.bezierCurveTo(18.9,80.77,45.9,25.77,5.9,2.77),a.closePath(),a.moveTo(-28,-24),a.bezierCurveTo(-57,-41,-93,-7,-121,-31),a.bezierCurveTo(-156,-49,-158,-93,-163,-127),a.bezierCurveTo(-164,-145,-183.7,-184.8,-184.9,-183.9),a.bezierCurveTo(-146,-142,-78.9,-151,-38.9,-110),a.bezierCurveTo(-15.5,-79.5,-37,-31.3,-4.5,-6),a.closePath(),a.moveTo(-20,29),a.bezierCurveTo(-38.8,57.7,-5.3,95.4,-30.9,121.9),a.bezierCurveTo(-50.1,154.9,-92.4,155.5,-126,159.1),a.bezierCurveTo(-143,158.1,-181.8,176.1,-183.9,176.1),a.bezierCurveTo(-143,138.1,-148,73.1,-107,36.1),a.bezierCurveTo(-74,13.1,-21,40.1,3,.1),a.closePath(),a.fill(),a.stroke(),a.restore(),a.lineWidth=2,a.strokeStyle=u===State.GameOverComputerWon||u===State.GameOverDraw?"#f9e427":"#ffbda3",a.beginPath(),a.arc(0,0,d,0,6.283185307179586,!0),a.stroke(),a.restore()}var f,g,h,i,j,l,m=k(),n=fb,o=lb(),p=ob(),q=mb(),r=pb(),s=nb(),t=qb(),u=cb(),v=zb,w=Bb,x=[],y=[];for(b&&(Eb.length=0),f=m.length;f--;)i=m[f],i.blockedByBoundary||i.touchingPlants.length>0?(b||!_.contains(Eb,i))&&(Eb.push(i),y.push(i)):x.push(i);if(v.save(),w.save(),l=wb*Db,v.scale(l,l),w.scale(l,l),b){for(v.drawImage(Cb,0,0,768,768),v.strokeStyle="#b38472",v.lineWidth=2,f=768;f-=96;)v.beginPath(),v.moveTo(f,0),v.lineTo(f,768),v.stroke(),v.beginPath(),v.moveTo(0,f),v.lineTo(768,f),v.stroke();v.lineWidth=1,v.strokeStyle="#000"}for(w.clearRect(0,0,768,768),w.lineWidth=4,w.strokeStyle="#f9e427",f=n.length;f--;)j=n[f],g=j.x,h=j.y,w.beginPath(),w.moveTo(g,h-8),w.lineTo(g,h+8),w.stroke(),w.beginPath(),w.moveTo(g-8,h),w.lineTo(g+8,h),w.stroke();for(w.lineWidth=1,w.strokeStyle="#000",f=y.length;f--;)i=y[f],i instanceof a.Flower?d(v,i):e(v,i);for(f=x.length;f--;)i=x[f],i instanceof a.Flower?d(w,i):e(w,i);v.restore(),w.restore(),Fb=!1}var T,U,V,W=[],X=[],Y=0,Z=0,$=ko.observable(Y),ab=ko.observable(Z),bb=ko.observable(0),cb=ko.observable(State.Initial),db=ko.observable(Level.Easy),eb=null,fb=[],gb=ko.observable(),hb=null,ib=0,jb=0,kb="#cd0032",lb=ko.observable(),mb=ko.observable(),nb=ko.observable(),ob=ko.observable(),pb=ko.observable(),qb=ko.observable(),rb=["#cd0032","#DD3E00","#cc6600","#ccb400","#99cc00","#66cc00","#00cc00","#00cc4e","#00cc99","#00b1cc","#0066cc","#0018cc","#4400cc","#8100cc","#cc00cc","#cc007e"],sb=ko.observable(!1),tb=ko.observable(!1),ub=ko.observable(!1),vb=ko.observable(!1),wb=1,xb=0,yb=document.getElementById("canvas-blocked"),zb=yb.getContext("2d"),Ab=document.getElementById("canvas-growing"),Bb=Ab.getContext("2d"),Cb=new Image,Db=window.devicePixelRatio||1,Eb=[],Fb=!1,Gb=["soil.png","grass-bg.png","bird.png","bird-off.png","colours.png","question-mark.png","traffic-light.png"],Hb=Gb.length,Ib=0,Jb=[{id:"plantSeed",src:"plant-seed.mp3"},{id:"invalid",src:"invalid.mp3"},{id:"removeWeed",src:"remove-weed.mp3"},{id:"flowerZapped",src:"flower-zapped.mp3"},{id:"gameOverWon",src:"game-over-won.mp3"},{id:"gameOverLost",src:"game-over-lost.mp3"},{id:"gameOverDraw",src:"game-over-draw.mp3"},{id:"stopSound",src:"stop-sound.mp3"}],Kb=Jb.length,Lb=0,Mb=ko.observable(!0),Nb=ko.computed(function(){var a=bb();return 0===a?0:Qb()&&Pb()?100:Math.round((a-1)/31*100)}),Ob=ko.computed(function(){switch(db()){case Level.Easy:return"Botany for Beginners";case Level.Medium:return"Medium Mulch";case Level.Hard:return"Heavyweight Horticulture"}}),Pb=ko.computed(function(){return 31===bb()}),Qb=ko.computed(function(){return cb()>=State.GameOverPlayerWon});return{initialize:b,day:bb,dayPercentageDisplay:Nb,level:db,levelDisplay:Ob,isGameOver:Qb,isLastDay:Pb,flowerCoverageDisplay:$,weedCoverageDisplay:ab,message:gb,gardenTapped:w,changeLevelFlyoutVisible:ub,toggleChangeLevelFlyout:F,changeLevel:G,newGameFlyoutVisible:vb,requestNewGame:I,toggleNewGameFlyout:J,confirmNewGame:K,instructionsFlyoutVisible:sb,toggleInstructionsFlyout:H,colourPickerFlyoutVisible:tb,toggleColourPickerFlyout:L,availableColours:rb,selectFlowerColour:M,resetDefaultFlowerColour:N,flowerColourOuter:lb,flowerColourInner:mb,flowerColourCenter:nb,isColourSelected:O,toggleSound:P,soundOn:Mb}}();a.game=b}(Flowers||(Flowers={})),function(){"use strict";document.addEventListener("DOMContentLoaded",function(){Flowers.game.initialize()},!1)}(),function(){"use strict";for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();